<!DOCTYPE html>
<html lang="de">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gatefall - Admin Panel</title>
    <style>
        /* Victory Builder Range Inputs */
        #panel-victory-builder input[type="range"] {
            width: 100%;
            height: 6px;
            background: rgba(0, 212, 255, 0.2);
            border-radius: 3px;
            outline: none;
            -webkit-appearance: none;
        }

        #panel-victory-builder input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 18px;
            height: 18px;
            background: #00d4ff;
            cursor: pointer;
            border-radius: 50%;
        }

        #panel-victory-builder input[type="range"]::-moz-range-thumb {
            width: 18px;
            height: 18px;
            background: #00d4ff;
            cursor: pointer;
            border-radius: 50%;
            border: none;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            color: #fff;
            min-height: 100vh;
        }
        
        .admin-header {
            background: rgba(0,0,0,0.3);
            padding: 20px;
            border-bottom: 2px solid #00d4ff;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        
        .admin-title {
            font-size: 28px;
            font-weight: bold;
            color: #00d4ff;
        }
        
        .admin-user {
            font-size: 14px;
            opacity: 0.8;
        }
        
        .header-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-export {
            background: #00ff88;
            color: #1a1a2e;
        }
        
        .btn-export:hover {
            background: #00cc6a;
        }
        
        .btn-import {
            background: #ff9500;
            color: #1a1a2e;
        }
        
        .btn-import:hover {
            background: #cc7700;
        }
        
        .btn-export {
            background: #00ff88;
            color: #1a1a2e;
        }
        
        .btn-export:hover {
            background: #00cc6a;
        }
        
        .btn-import {
            background: #ff9500;
            color: #1a1a2e;
        }
        
        .btn-import:hover {
            background: #cc7700;
        }
        
        .admin-container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }
        
        .admin-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .admin-tab {
            padding: 12px 24px;
            background: rgba(255,255,255,0.1);
            border: 2px solid transparent;
            border-radius: 8px;
            cursor: pointer;
            transition: all 0.3s;
            font-size: 14px;
            font-weight: bold;
        }
        
        .admin-tab:hover {
            background: rgba(255,255,255,0.15);
        }
        
        .admin-tab.active {
            background: #00d4ff;
            color: #1a1a2e;
            border-color: #00d4ff;
        }
        
        .admin-panel {
            display: none;
            background: rgba(0,0,0,0.3);
            border-radius: 12px;
            padding: 30px;
            min-height: 600px;
        }
        
        .admin-panel.active {
            display: block;
        }
        
        .panel-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }
        
        .panel-title {
            font-size: 24px;
            color: #00d4ff;
        }
        
        .btn {
            padding: 10px 20px;
            background: #00d4ff;
            color: #1a1a2e;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: bold;
            transition: all 0.3s;
        }
        
        .btn:hover {
            background: #00b8e6;
            transform: translateY(-2px);
        }
        
        .btn-danger {
            background: #ff4444;
            color: white;
        }
        
        .btn-danger:hover {
            background: #cc0000;
        }
        
        .filter-tabs {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }
        
        .filter-tab {
            padding: 8px 16px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            color: #fff;
            border-radius: 6px;
            cursor: pointer;
            font-size: 13px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .filter-tab:hover {
            background: rgba(255,255,255,0.15);
            border-color: #00d4ff;
        }
        
        .filter-tab.active {
            background: #00d4ff;
            color: #1a1a2e;
            border-color: #00d4ff;
        }
        
        .items-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 20px;
            margin-top: 20px;
        }
        
        .item-card {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(255,255,255,0.1);
            border-radius: 8px;
            padding: 20px;
            transition: all 0.3s;
        }
        
        .item-card:hover {
            background: rgba(255,255,255,0.08);
            border-color: #00d4ff;
        }
        
        .item-icon {
            width: 64px;
            height: 64px;
            background: rgba(0,212,255,0.2);
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 32px;
            margin-bottom: 10px;
        }
        
        .item-icon img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            border-radius: 8px;
        }
        
        .item-name {
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 8px;
            color: #00d4ff;
        }
        
        .item-desc {
            font-size: 13px;
            opacity: 0.7;
            margin-bottom: 15px;
        }
        
        .item-stats {
            font-size: 12px;
            color: #aaa;
            margin-bottom: 15px;
        }
        
        .item-actions {
            display: flex;
            gap: 10px;
        }
        
        .btn-small {
            padding: 6px 12px;
            font-size: 12px;
        }
        
        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0,0,0,0.8);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }
        
        .modal.active {
            display: flex;
        }
        
        .modal-content {
            background: #1a1a2e;
            border: 2px solid #00d4ff;
            border-radius: 12px;
            padding: 30px;
            max-width: 800px;
            width: 90%;
            max-height: 90vh;
            overflow-y: auto;
        }
        
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .modal-title {
            font-size: 24px;
            color: #00d4ff;
        }
        
        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 32px;
            height: 32px;
        }
        
        .form-group {
            margin-bottom: 20px;
        }
        
        .form-label {
            display: block;
            margin-bottom: 8px;
            color: #00d4ff;
            font-weight: bold;
        }
        
        .form-input,
        .form-select,
        .form-textarea {
            width: 100%;
            padding: 10px;
            background: rgba(255,255,255,0.1);
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 6px;
            color: white;
            font-family: inherit;
        }
        
        .form-select option {
            background: #1a1a2e;
            color: white;
            padding: 10px;
        }
        
        .form-select optgroup {
            background: #0f1419;
            color: #00d4ff;
            font-weight: bold;
        }
        
        .form-textarea {
            min-height: 100px;
            resize: vertical;
        }
        
        .form-input:focus,
        .form-select:focus,
        .form-textarea:focus {
            outline: none;
            border-color: #00d4ff;
        }
        
        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 15px;
        }
        
        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
        }
        
        .checkbox-label {
            display: flex;
            align-items: center;
            gap: 8px;
            cursor: pointer;
        }
        
        .checkbox-label input {
            width: 18px;
            height: 18px;
        }
        
        .image-upload {
            border: 2px dashed rgba(255,255,255,0.3);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .image-upload:hover {
            border-color: #00d4ff;
            background: rgba(0,212,255,0.05);
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 200px;
            margin: 10px auto;
            border-radius: 8px;
        }
        
        .no-items {
            text-align: center;
            padding: 60px 20px;
            opacity: 0.5;
            font-size: 18px;
        }
    </style>
</head>
<body>
    <div class="admin-header">
        <div class="admin-title">‚öôÔ∏è GATEFALL ADMIN PANEL</div>
        <div class="admin-user">
            <span id="admin-name">Loading...</span> | 
            <a href="index.html" style="color: #00d4ff;">Zur√ºck zum Spiel</a>
        </div>
    </div>
    
    <div class="admin-container">
        <div class="admin-tabs">
            <button class="admin-tab active" data-tab="combat-system">‚öîÔ∏è Combat System</button>
            <button class="admin-tab" data-tab="enemies">üëπ Gegner</button>
            <button class="admin-tab" data-tab="bosses">üëë Bosse</button>
            <button class="admin-tab" data-tab="characters">üë§ Characters</button>
            <button class="admin-tab" data-tab="guilds">üèõÔ∏è Gilden</button>
            <button class="admin-tab" data-tab="backgrounds">üé® Kampf-BGs</button>
            <button class="admin-tab" data-tab="hunter-ranks">üèÜ Hunter-R√§nge</button>
            <button class="admin-tab" data-tab="world-map">üó∫Ô∏è Weltkarte</button>
            <button class="admin-tab" data-tab="ui-background">üñºÔ∏è UI-Hintergrund</button>
            <button class="admin-tab" data-tab="login-layout">üé≠ Login-Layout</button>
            <button class="admin-tab" data-tab="game-settings">‚öôÔ∏è Einstellungen</button>
            <button class="admin-tab" data-tab="chat">üí¨ Chat</button>
            <button class="admin-tab" data-tab="victory-builder">üèÜ Victory Popup</button>
            <button class="admin-tab" onclick="window.open('admin-world-editor.html', '_blank')" style="background: #FFD700; color: #1a1a2e; border-color: #FFD700;">üåç Weltkarten-Editor</button>
            <button class="admin-tab" onclick="window.open('admin-city-map-editor.html', '_blank')" style="background: #2196F3; color: white; border-color: #2196F3;">üèôÔ∏è Stadtkarten-Editor</button>
            <button class="admin-tab" data-tab="database">üíæ Datenbank</button>
        </div>
        
        <!-- Combat System Panel -->
        <div class="admin-panel active" id="panel-combat-system">
            <div class="panel-header">
                <h2 class="panel-title">‚öîÔ∏è Combat System</h2>
            </div>
            
            <!-- Sub-Navigation -->
            <div style="display: flex; gap: 10px; margin-bottom: 20px; border-bottom: 2px solid rgba(255,255,255,0.1); padding-bottom: 10px;">
                <button class="filter-tab active" onclick="showCombatSection('actions')" id="combat-tab-actions">üéØ Basis-Aktionen</button>
                <button class="filter-tab" onclick="showCombatSection('ranks')" id="combat-tab-ranks">üìä Rang-Multiplikatoren</button>
                <button class="filter-tab" onclick="showCombatSection('skills-overview')" id="combat-tab-skills-overview">üìñ Skills-√úbersicht</button>
                <button class="filter-tab" onclick="showCombatSection('skills-manage')" id="combat-tab-skills-manage">‚ú® Skills verwalten</button>
            </div>

            <!-- Section: Basis-Aktionen -->
            <div id="combat-section-actions" class="combat-section">
                <div style="background: rgba(52, 152, 219, 0.2); border-left: 4px solid #3498db; padding: 15px; margin-bottom: 20px; border-radius: 5px;">
                    <strong>‚ÑπÔ∏è Basis-Aktionen:</strong> Diese Aktionen stehen allen Spielern zur Verf√ºgung.<br>
                    Schaden wird durch den <strong>Hunter-Rang Multiplikator</strong> skaliert (E: 1.0x ‚Üí SSS: 4.0x)
                </div>
                
                <div class="panel-header">
                    <h3>Angriffe verwalten</h3>
                    <button class="btn" onclick="adminUI.createAttackAction()">+ Neuer Angriff</button>
                </div>
                <div id="attack-actions-list" class="items-grid"></div>
            </div>

            <!-- Section: Rang-Multiplikatoren -->
            <div id="combat-section-ranks" class="combat-section" style="display: none;">
                <div style="background: rgba(52, 152, 219, 0.2); border-left: 4px solid #3498db; padding: 15px; margin-bottom: 20px; border-radius: 5px;">
                    <strong>‚ÑπÔ∏è Rang-System √úbersicht:</strong><br>
                    Diese Werte bestimmen die Kampfst√§rke basierend auf dem Hunter Rank (E ‚Üí SSS).<br>
                    ‚Ä¢ <strong>Angriffs-Multiplikator:</strong> Multipliziert den Basisschaden<br>
                    ‚Ä¢ <strong>Block-Reduzierung:</strong> Prozent des Schadens der geblockt wird<br>
                    ‚Ä¢ <strong>Dodge-Chance:</strong> Basis-Ausweichwahrscheinlichkeit (+ Rang-Unterschied Bonus)
                </div>

                <div id="rank-stats-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 20px; margin-bottom: 30px;"></div>

                <table style="width: 100%; background: rgba(255,255,255,0.05); border-radius: 10px; overflow: hidden;">
                    <thead>
                        <tr style="background: rgba(0,0,0,0.3);">
                            <th style="padding: 12px; text-align: center;">Rang</th>
                            <th style="padding: 12px; text-align: center;">Angriff</th>
                            <th style="padding: 12px; text-align: center;">Block</th>
                            <th style="padding: 12px; text-align: center;">Dodge</th>
                            <th style="padding: 12px; text-align: center;">Progression</th>
                        </tr>
                    </thead>
                    <tbody id="rank-comparison-body"></tbody>
                </table>
            </div>

            <!-- Section: Skills-√úbersicht (Read-Only) -->
            <div id="combat-section-skills-overview" class="combat-section" style="display: none;">
                <div style="background: rgba(52, 152, 219, 0.2); border-left: 4px solid #3498db; padding: 15px; margin-bottom: 20px; border-radius: 5px;">
                    <strong>üìä Wichtig:</strong> Alle Schaden-Werte werden durch den <strong>Hunter-Rang Multiplikator</strong> skaliert!<br>
                    E-Rang: 1.0x | D: 1.2x | C: 1.5x | B: 2.0x | A: 2.5x | S: 3.0x | SS: 3.5x | SSS: 4.0x
                </div>

                <!-- Legende -->
                <div style="display: flex; gap: 20px; justify-content: center; margin: 20px 0; flex-wrap: wrap;">
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 20px; height: 20px; border-radius: 3px; background: #3498db;"></div>
                        <span>Modul 1</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 20px; height: 20px; border-radius: 3px; background: #9b59b6;"></div>
                        <span>Modul 2</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 20px; height: 20px; border-radius: 3px; background: #e67e22;"></div>
                        <span>Modul 3</span>
                    </div>
                    <div style="display: flex; align-items: center; gap: 8px;">
                        <div style="width: 20px; height: 20px; border-radius: 3px; background: #f39c12;"></div>
                        <span>Exklusiv (B-Rang+)</span>
                    </div>
                </div>

                <div id="roles-container" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(400px, 1fr)); gap: 20px;"></div>
            </div>

            <!-- Section: Skills verwalten (Edit/Create) -->
            <div id="combat-section-skills-manage" class="combat-section" style="display: none;">
                <div style="background: rgba(52, 152, 219, 0.2); border-left: 4px solid #3498db; padding: 15px; margin-bottom: 20px; border-radius: 5px;">
                    <strong>‚ú® Skills verwalten:</strong> Hier kannst du Skills erstellen, bearbeiten und l√∂schen.<br>
                    Alle √Ñnderungen werden sofort in der Datenbank gespeichert.
                </div>
                
                <div class="panel-header">
                    <h3>Skills verwalten</h3>
                    <button class="btn" onclick="adminUI.openSkillModal()">+ Neuer Skill</button>
                </div>
                
                <div class="filter-tabs" style="margin-bottom: 20px;">
                    <button class="filter-tab active" onclick="adminUI.filterSkills('all')">Alle</button>
                    <button class="filter-tab" onclick="adminUI.filterSkills('damage')">Schaden</button>
                    <button class="filter-tab" onclick="adminUI.filterSkills('heal')">Heilung</button>
                    <button class="filter-tab" onclick="adminUI.filterSkills('buff')">Buffs</button>
                    <button class="filter-tab" onclick="adminUI.filterSkills('debuff')">Debuffs</button>
                    <button class="filter-tab" onclick="adminUI.filterSkills('dot')">DoT</button>
                    <button class="filter-tab" onclick="adminUI.filterSkills('stun')">Stun</button>
                </div>
                
                <div id="skills-list" class="items-grid"></div>
            </div>
        </div>
        
        <!-- Enemies Panel -->
        <div class="admin-panel" id="panel-enemies">
            <div class="panel-header">
                <h2 class="panel-title">Gegner verwalten</h2>
                <button class="btn" onclick="adminUI.openEnemyModal()">+ Neuer Gegner</button>
            </div>
            <div id="enemies-list" class="items-grid"></div>
        </div>
        
        <!-- Bosses Panel -->
        <div class="admin-panel" id="panel-bosses">
            <div class="panel-header">
                <h2 class="panel-title">Bosse verwalten</h2>
                <button class="btn" onclick="adminUI.openBossModal()">+ Neuer Boss</button>
            </div>
            <div id="bosses-list" class="items-grid"></div>
        </div>
        
        <!-- Characters Panel -->
        <div class="admin-panel" id="panel-characters">
            <div class="panel-header">
                <h2 class="panel-title">Characters verwalten</h2>
                <button class="btn" onclick="adminUI.openCharacterModal()">+ Neuer Character</button>
            </div>
            <div id="characters-list" class="items-grid"></div>
        </div>
        
        <!-- Guilds Panel -->
        <div class="admin-panel" id="panel-guilds">
            <div class="panel-header">
                <h2 class="panel-title">NPC Gilden verwalten</h2>
                <button class="btn" onclick="adminUI.openGuildModal()">+ Neue Gilde</button>
            </div>
            <div id="guilds-list" class="items-grid"></div>
        </div>
        
        <!-- Backgrounds Panel -->
        <div class="admin-panel" id="panel-backgrounds">
            <div class="panel-header">
                <h2 class="panel-title">Kampf-Hintergr√ºnde</h2>
                <button class="btn" onclick="adminUI.openBackgroundModal()">+ Neuer Hintergrund</button>
            </div>
            <div id="backgrounds-list" class="items-grid"></div>
        </div>
        
        <!-- World Map Panel -->
        <div class="admin-panel" id="panel-world-map">
            <div class="panel-header">
                <h2 class="panel-title">üó∫Ô∏è Weltkarte Einstellungen</h2>
            </div>
            
            <div style="background: rgba(76,175,80,0.1); border: 1px solid #4CAF50; border-radius: 8px; padding: 25px; margin-bottom: 20px;">
                <h3 style="color: #4CAF50; margin-bottom: 15px;">üìç Aktuelle Weltkarte</h3>
                <div id="current-world-map" style="margin-bottom: 20px;">
                    <img id="world-map-preview" src="http://localhost:3001/public/assets/sprites/Weltkarte 1.png" style="max-width: 100%; max-height: 400px; border-radius: 8px; border: 2px solid #4CAF50;" onerror="this.alt='‚ö†Ô∏è Karte nicht geladen'">
                </div>
                
                <h3 style="color: #4CAF50; margin: 25px 0 15px 0;">üì§ Neue Weltkarte hochladen</h3>
                <div class="form-group">
                    <label>Bild ausw√§hlen (max 10MB, empfohlen: 1000x800px)</label>
                    <input type="file" id="world-map-upload" accept="image/*" class="form-input" style="padding: 10px;">
                </div>
                
                <button class="btn" onclick="uploadWorldMap()" style="background: #4CAF50; font-size: 16px; padding: 12px 24px;">
                    üíæ Weltkarte hochladen
                </button>
                
                <div id="upload-status" style="margin-top: 15px; font-size: 14px;"></div>
            </div>
            
            <div style="background: rgba(33,150,243,0.1); border: 1px solid #2196F3; border-radius: 8px; padding: 20px;">
                <h3 style="color: #2196F3; margin-bottom: 10px;">‚ÑπÔ∏è Hinweise</h3>
                <ul style="margin-left: 20px; color: #ccc; line-height: 1.8;">
                    <li>Empfohlene Bildgr√∂√üe: 1000x800 Pixel</li>
                    <li>Unterst√ºtzte Formate: JPEG, PNG, GIF, WebP</li>
                    <li>Maximale Dateigr√∂√üe: 10MB</li>
                    <li>Das neue Bild ersetzt die aktuelle Weltkarte im Spiel</li>
                </ul>
            </div>
        </div>
        
        <!-- Login Layout Editor Panel -->
        <div class="admin-panel" id="panel-login-layout">
            <div class="panel-header">
                <h2 class="panel-title">üé≠ Login-Layout Editor</h2>
            </div>
            
            <div style="max-width: 1200px;">
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px;">
                    <!-- Left Column: Controls -->
                    <div>
                        <!-- Login Title Settings -->
                        <div style="background: rgba(149,117,255,0.1); border: 2px solid #9575ff; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <h3 style="color: #9575ff; margin-bottom: 15px; font-size: 18px;">üìù Login-Titel</h3>
                            <div class="form-group">
                                <label class="form-label">Titel-Text</label>
                                <input type="text" id="login-title-text" value="LOGIN" 
                                       style="padding: 10px; background: rgba(26,31,46,0.8); border: 2px solid #5a4a7f; border-radius: 8px; color: #fff; width: 100%;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Schriftgr√∂√üe (px)</label>
                                <input type="number" id="login-title-size" value="48" min="20" max="80" 
                                       style="padding: 10px; background: rgba(26,31,46,0.8); border: 2px solid #5a4a7f; border-radius: 8px; color: #fff; width: 100%;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Gradient Farbe 1</label>
                                <input type="color" id="login-title-color1" value="#ffffff" 
                                       style="padding: 5px; background: rgba(26,31,46,0.8); border: 2px solid #5a4a7f; border-radius: 8px; width: 100%; height: 50px; cursor: pointer;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Gradient Farbe 2</label>
                                <input type="color" id="login-title-color2" value="#ffd700" 
                                       style="padding: 5px; background: rgba(26,31,46,0.8); border: 2px solid #5a4a7f; border-radius: 8px; width: 100%; height: 50px; cursor: pointer;">
                            </div>
                        </div>

                        <!-- Input Field Settings -->
                        <div style="background: rgba(149,117,255,0.1); border: 2px solid #9575ff; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <h3 style="color: #9575ff; margin-bottom: 15px; font-size: 18px;">üìß Input-Felder</h3>
                            <div class="form-group">
                                <label class="form-label">Schriftgr√∂√üe (px)</label>
                                <input type="number" id="login-input-size" value="16" min="12" max="24" 
                                       style="padding: 10px; background: rgba(26,31,46,0.8); border: 2px solid #5a4a7f; border-radius: 8px; color: #fff; width: 100%;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Border-Farbe</label>
                                <input type="color" id="login-input-border" value="#d4af37" 
                                       style="padding: 5px; background: rgba(26,31,46,0.8); border: 2px solid #5a4a7f; border-radius: 8px; width: 100%; height: 50px; cursor: pointer;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Padding (px)</label>
                                <input type="number" id="login-input-padding" value="15" min="5" max="30" 
                                       style="padding: 10px; background: rgba(26,31,46,0.8); border: 2px solid #5a4a7f; border-radius: 8px; color: #fff; width: 100%;">
                            </div>
                        </div>

                        <!-- Button Settings -->
                        <div style="background: rgba(149,117,255,0.1); border: 2px solid #9575ff; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <h3 style="color: #9575ff; margin-bottom: 15px; font-size: 18px;">üîò Login-Button</h3>
                            <div class="form-group">
                                <label class="form-label">Button-Text</label>
                                <input type="text" id="login-btn-text" value="LOGIN" 
                                       style="padding: 10px; background: rgba(26,31,46,0.8); border: 2px solid #5a4a7f; border-radius: 8px; color: #fff; width: 100%;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Schriftgr√∂√üe (px)</label>
                                <input type="number" id="login-btn-size" value="18" min="12" max="28" 
                                       style="padding: 10px; background: rgba(26,31,46,0.8); border: 2px solid #5a4a7f; border-radius: 8px; color: #fff; width: 100%;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Gradient Farbe 1</label>
                                <input type="color" id="login-btn-color1" value="#4a3520" 
                                       style="padding: 5px; background: rgba(26,31,46,0.8); border: 2px solid #5a4a7f; border-radius: 8px; width: 100%; height: 50px; cursor: pointer;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Gradient Farbe 2</label>
                                <input type="color" id="login-btn-color2" value="#6b4f30" 
                                       style="padding: 5px; background: rgba(26,31,46,0.8); border: 2px solid #5a4a7f; border-radius: 8px; width: 100%; height: 50px; cursor: pointer;">
                            </div>
                        </div>

                        <!-- Position Settings -->
                        <div style="background: rgba(149,117,255,0.1); border: 2px solid #9575ff; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <h3 style="color: #9575ff; margin-bottom: 15px; font-size: 18px;">üìê Position & Gr√∂√üe</h3>
                            <div class="form-group">
                                <label class="form-label">Max. Breite (px)</label>
                                <input type="number" id="login-max-width" value="400" min="300" max="600" 
                                       style="padding: 10px; background: rgba(26,31,46,0.8); border: 2px solid #5a4a7f; border-radius: 8px; color: #fff; width: 100%;">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Abstand von oben (px)</label>
                                <input type="number" id="login-margin-top" value="0" min="-100" max="200" 
                                       style="padding: 10px; background: rgba(26,31,46,0.8); border: 2px solid #5a4a7f; border-radius: 8px; color: #fff; width: 100%;">
                            </div>
                        </div>

                        <!-- Animation Settings -->
                        <div style="background: rgba(149,117,255,0.1); border: 2px solid #9575ff; border-radius: 12px; padding: 20px; margin-bottom: 20px;">
                            <h3 style="color: #9575ff; margin-bottom: 15px; font-size: 18px;">‚ú® Animationen</h3>
                            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
                                <label class="form-label" style="margin: 0;">Portal Glow</label>
                                <input type="checkbox" id="anim-portal" checked 
                                       style="width: 24px; height: 24px; cursor: pointer;">
                            </div>
                            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
                                <label class="form-label" style="margin: 0;">Drachen-Feuer</label>
                                <input type="checkbox" id="anim-dragon" checked 
                                       style="width: 24px; height: 24px; cursor: pointer;">
                            </div>
                            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
                                <label class="form-label" style="margin: 0;">Schwert-Glanz</label>
                                <input type="checkbox" id="anim-sword" checked 
                                       style="width: 24px; height: 24px; cursor: pointer;">
                            </div>
                            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
                                <label class="form-label" style="margin: 0;">Himmel-Blitz</label>
                                <input type="checkbox" id="anim-lightning" checked 
                                       style="width: 24px; height: 24px; cursor: pointer;">
                            </div>
                            <div class="form-group" style="display: flex; align-items: center; justify-content: space-between;">
                                <label class="form-label" style="margin: 0;">Rahmen-Feuer</label>
                                <input type="checkbox" id="anim-frame" checked 
                                       style="width: 24px; height: 24px; cursor: pointer;">
                            </div>
                        </div>

                        <!-- Action Buttons -->
                        <div style="display: flex; gap: 10px;">
                            <button onclick="applyLoginLayout()" 
                                    style="flex: 1; padding: 15px 30px; background: linear-gradient(135deg, #4CAF50, #45a049); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(76,175,80,0.4); transition: all 0.3s ease;">
                                ‚úÖ √Ñnderungen anwenden
                            </button>
                            <button onclick="resetLoginLayout()" 
                                    style="flex: 1; padding: 15px 30px; background: linear-gradient(135deg, #ff5252, #d32f2f); color: white; border: none; border-radius: 8px; font-size: 16px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(255,82,82,0.4); transition: all 0.3s ease;">
                                üîÑ Zur√ºcksetzen
                            </button>
                        </div>
                    </div>

                    <!-- Right Column: Live Preview -->
                    <div>
                        <div style="background: rgba(149,117,255,0.1); border: 2px solid #9575ff; border-radius: 12px; padding: 20px; position: sticky; top: 20px;">
                            <h3 style="color: #9575ff; margin-bottom: 15px; font-size: 18px;">üëÅÔ∏è Live-Vorschau</h3>
                            <div id="login-preview" style="width: 100%; height: 600px; border-radius: 8px; background-image: url('Loginhintergrund.png'); background-size: cover; background-position: center; position: relative; overflow: hidden; box-shadow: 0 8px 24px rgba(0,0,0,0.6);">
                                <!-- Preview Login Form -->
                                <div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); text-align: center; width: 90%; max-width: 400px;" id="preview-container">
                                    <h1 id="preview-title" style="font-size: 48px; font-weight: bold; margin-bottom: 30px; background: linear-gradient(135deg, #ffffff, #ffd700); -webkit-background-clip: text; -webkit-text-fill-color: transparent; text-shadow: 0 0 30px rgba(255,215,0,0.6), 0 0 60px rgba(255,215,0,0.3); letter-spacing: 4px;">
                                        LOGIN
                                    </h1>
                                    <div style="display: flex; flex-direction: column; gap: 15px; margin-bottom: 20px;">
                                        <input type="text" placeholder="Email" id="preview-input" readonly
                                               style="padding: 15px 15px 15px 45px; background: rgba(20, 15, 30, 0.85); border: 2px solid #d4af37; border-radius: 8px; color: #fff; font-size: 16px; backdrop-filter: blur(10px);">
                                        <input type="password" placeholder="Passwort" readonly
                                               style="padding: 15px 15px 15px 45px; background: rgba(20, 15, 30, 0.85); border: 2px solid #d4af37; border-radius: 8px; color: #fff; font-size: 16px; backdrop-filter: blur(10px);">
                                    </div>
                                    <button id="preview-btn" style="width: 100%; padding: 15px; background: linear-gradient(135deg, #4a3520, #6b4f30); border: 2px solid #d4af37; border-radius: 8px; color: #ffd700; font-size: 18px; font-weight: bold; cursor: pointer; box-shadow: 0 4px 15px rgba(212,175,55,0.3); letter-spacing: 2px;">
                                        LOGIN
                                    </button>
                                </div>
                            </div>
                            <p style="margin-top: 15px; opacity: 0.7; font-size: 14px; text-align: center;">√Ñnderungen werden sofort in der Vorschau angezeigt</p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Chat Control Panel -->
        <div class="admin-panel" id="panel-chat">
            <div class="panel-header">
                <h2 class="panel-title">Global Chat Verwaltung</h2>
            </div>
            
            <div style="background: rgba(0,212,255,0.1); border: 1px solid #00d4ff; border-radius: 8px; padding: 20px; margin-bottom: 30px;">
                <h3 style="color: #00d4ff; margin-bottom: 15px;">üí¨ Chat Status</h3>
                <div id="chat-status" style="font-size: 18px; margin-bottom: 15px;">
                    Status: <span id="chat-status-text" style="color: #00ff88; font-weight: bold;">Aktiv</span>
                </div>
                <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                    <button class="btn" onclick="adminUI.toggleChat(true)" style="background: #00ff88; color: #1a1a2e;">
                        ‚ñ∂Ô∏è Chat Aktivieren
                    </button>
                    <button class="btn btn-danger" onclick="adminUI.toggleChat(false)">
                        ‚è∏Ô∏è Chat Deaktivieren
                    </button>
                    <button class="btn" onclick="adminUI.restartChat()" style="background: #ff9500;">
                        üîÑ Chat Neustarten
                    </button>
                    <button class="btn btn-secondary" onclick="adminUI.clearChatHistory()">
                        üóëÔ∏è Verlauf L√∂schen
                    </button>
                </div>
            </div>
            
            <div style="background: rgba(255,255,255,0.05); border-radius: 8px; padding: 20px;">
                <h3 style="color: #fff; margin-bottom: 15px;">üìä Chat Statistiken</h3>
                <div id="chat-stats" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <div class="stat-card">
                        <div class="stat-label">Aktive Benutzer</div>
                        <div class="stat-value" id="chat-users-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Nachrichten (heute)</div>
                        <div class="stat-value" id="chat-messages-count">0</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Letzter Neustart</div>
                        <div class="stat-value" id="chat-last-restart">Nie</div>
                    </div>
                </div>
            </div>
            
            <style>
                .stat-card {
                    background: rgba(0,212,255,0.1);
                    border: 1px solid rgba(0,212,255,0.3);
                    border-radius: 8px;
                    padding: 15px;
                    text-align: center;
                }
                .stat-label {
                    color: #00d4ff;
                    font-size: 14px;
                    margin-bottom: 8px;
                }
                .stat-value {
                    color: #fff;
                    font-size: 24px;
                    font-weight: bold;
                }
            </style>
        </div>
        
        <!-- Hunter Ranks Panel -->
        <div class="admin-panel" id="panel-hunter-ranks">
            <div class="panel-header">
                <h2 class="panel-title">üèÜ Hunter-R√§nge verwalten</h2>
            </div>
            
            <!-- Player Rank Management -->
            <div style="background: rgba(76,175,80,0.1); border: 1px solid #4CAF50; border-radius: 8px; padding: 20px; margin-bottom: 30px;">
                <h3 style="color: #4CAF50; margin-bottom: 15px;">üë§ Spieler-Rang √§ndern</h3>
                <div style="max-width: 600px;">
                    <div class="form-group">
                        <label class="form-label">Spieler (aktuell eingeloggt)</label>
                        <input type="text" class="form-input" id="player-display-name" readonly style="background: rgba(255,255,255,0.05);">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Aktueller Rang</label>
                        <input type="text" class="form-input" id="current-rank" readonly style="background: rgba(255,255,255,0.05); font-weight: bold;">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Neuer Rang</label>
                        <select class="form-select" id="new-rank">
                            <option value="E">üü§ E-Rang (Training)</option>
                            <option value="D">üü§ D-Rang (Erwachen)</option>
                            <option value="C">üü¢ C-Rang (Volle Module)</option>
                            <option value="B">üîµ B-Rang (Spezialisierung)</option>
                            <option value="A">üü£ A-Rang (Vertiefung)</option>
                            <option value="S">üî¥ S-Rang (Meisterschaft)</option>
                            <option value="SS">üü• SS-Rang (Affinity Cap 5)</option>
                            <option value="SSS">üü•üü• SSS-Rang (Kein Malus)</option>
                        </select>
                    </div>
                    <button class="btn" onclick="adminUI.updatePlayerRank()">üíæ Rang aktualisieren</button>
                </div>
            </div>
            
            <!-- Specialization Management (B-Rang+) -->
            <div style="background: rgba(156,39,176,0.1); border: 1px solid #9C27B0; border-radius: 8px; padding: 20px; margin-bottom: 30px;">
                <h3 style="color: #9C27B0; margin-bottom: 15px;">‚≠ê Spezialisierung setzen (ab B-Rang)</h3>
                <div style="max-width: 600px;">
                    <div class="form-group">
                        <label class="form-label">Spezialisierung</label>
                        <select class="form-select" id="player-specialization">
                            <option value="">-- Keine Spezialisierung --</option>
                            <optgroup label="W√§chter">
                                <option value="waechter_fortress">Bollwerk (Standhaftigkeit) ‚Üí Unersch√ºtterlich</option>
                                <option value="waechter_avenger">Vergelter (Vergeltung) ‚Üí R√§chender Schlag</option>
                                <option value="waechter_protector">Schildtr√§ger (Schutzwall) ‚Üí Schutzbanner</option>
                            </optgroup>
                            <optgroup label="Assassine">
                                <option value="assassine_shadow">Schattenj√§ger (Hinterhalt) ‚Üí T√∂dliche Erscheinung</option>
                                <option value="assassine_blade">Klingenmeister (Pr√§zision) ‚Üí Perfekter Schnitt</option>
                                <option value="assassine_poison">Blutl√§ufer (DoT) ‚Üí Blutrausch</option>
                            </optgroup>
                            <optgroup label="Magier">
                                <option value="magier_pyro">Elementarist (Schaden) ‚Üí Elementare Entladung</option>
                                <option value="magier_arcane">Arkanist (Effizienz) ‚Üí Arkane Matrix</option>
                                <option value="magier_frost">Kontrollmagier (CC) ‚Üí Zeitfessel</option>
                            </optgroup>
                            <optgroup label="Heiler">
                                <option value="heiler_priest">Lichtweber (Heilung) ‚Üí Gnadenstrahl</option>
                                <option value="heiler_guardian">Segensh√ºter (Buffs) ‚Üí G√∂ttliche Gunst</option>
                                <option value="heiler_sage">Lebensw√§chter (Sustain) ‚Üí Lebensw√§chter</option>
                            </optgroup>
                            <optgroup label="Berserker">
                                <option value="berserker_rage">Zorngeborener (Eskalation) ‚Üí Unb√§ndiger Zorn</option>
                                <option value="berserker_blood">Blutritter (Risiko) ‚Üí Blutvertrag</option>
                                <option value="berserker_titan">Sturmbrecher (Durchbruch) ‚Üí Sturmansturm</option>
                            </optgroup>
                            <optgroup label="Beschw√∂rer">
                                <option value="beschwoerer_summoner">Paktmeister (Bindung) ‚Üí Seelenpakt</option>
                                <option value="beschwoerer_swarm">Schwarmherr (√úberw√§ltigung) ‚Üí Schwarmruf</option>
                                <option value="beschwoerer_beastmaster">Dominator (Kontrolle) ‚Üí Dominanzbefehl</option>
                            </optgroup>
                            <optgroup label="Fluchwirker">
                                <option value="fluchwirker_plague">Seuchenmeister (DoT) ‚Üí Pestexplosion</option>
                                <option value="fluchwirker_fear">Angstbringer (Kontrolle) ‚Üí Schreckensvision</option>
                                <option value="fluchwirker_doom">Richter der Verdammnis (Finish) ‚Üí Letztes Urteil</option>
                            </optgroup>
                        </select>
                    </div>
                    <button class="btn" onclick="adminUI.updatePlayerSpecialization()">üí´ Spezialisierung setzen</button>
                </div>
            </div>
            
            <!-- Affinity Cap Bonus Management (SS/SSS-Rang) -->
            <div style="background: rgba(255,152,0,0.1); border: 1px solid #FF9800; border-radius: 8px; padding: 20px; margin-bottom: 30px;">
                <h3 style="color: #FF9800; margin-bottom: 15px;">üî• Affinit√§t-Cap Bonus (SS/SSS-Rang)</h3>
                <div style="max-width: 600px;">
                    <div class="form-group">
                        <label class="form-label">Aktuelles Affinit√§t-Cap</label>
                        <input type="text" class="form-input" id="current-affinity-cap" readonly style="background: rgba(255,255,255,0.05); font-weight: bold;">
                    </div>
                    <div class="form-group">
                        <label class="form-label">Bonus-Punkte (+0 bis +10)</label>
                        <input type="number" class="form-input" id="affinity-cap-bonus" min="0" max="10" value="0">
                        <small style="color: #999; display: block; margin-top: 5px;">
                            SS-Rang Basis: 5 | SSS-Rang Basis: 5 | Mit Bonus: bis zu 15 Skills
                        </small>
                    </div>
                    <button class="btn" onclick="adminUI.updateAffinityCapBonus()">üî• Bonus aktualisieren</button>
                </div>
            </div>
            
            <!-- Rank System Overview -->
            <div style="background: rgba(255,193,7,0.1); border: 1px solid #FFC107; border-radius: 8px; padding: 20px;">
                <h3 style="color: #FFC107; margin-bottom: 15px;">üìã Rang-System √úbersicht</h3>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                    <div style="background: rgba(121,85,72,0.2); padding: 15px; border-radius: 6px;">
                        <h4 style="color: #795548; margin: 0 0 10px 0;">üü§ E-Rang (Lvl 1)</h4>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em; color: #ccc;">
                            <li>1 Modul (3 Skills)</li>
                            <li>3 Skill-Slots</li>
                            <li>Affinit√§t-Cap: 1</li>
                            <li>Basis-Training</li>
                        </ul>
                    </div>
                    <div style="background: rgba(121,85,72,0.2); padding: 15px; border-radius: 6px;">
                        <h4 style="color: #8D6E63; margin: 0 0 10px 0;">üü§ D-Rang (Lvl 1+)</h4>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em; color: #ccc;">
                            <li>2 Module (6 Skills)</li>
                            <li>4 Skill-Slots</li>
                            <li>Affinit√§t-Cap: 1</li>
                            <li>30% Fremdskill-Malus</li>
                        </ul>
                    </div>
                    <div style="background: rgba(76,175,80,0.2); padding: 15px; border-radius: 6px;">
                        <h4 style="color: #4CAF50; margin: 0 0 10px 0;">üü¢ C-Rang (Lvl 10+)</h4>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em; color: #ccc;">
                            <li>3 Module (alle 9 Skills)</li>
                            <li>5 Skill-Slots</li>
                            <li>Affinit√§t-Cap: 2</li>
                            <li>30% Malus, 10% Passive</li>
                        </ul>
                    </div>
                    <div style="background: rgba(33,150,243,0.2); padding: 15px; border-radius: 6px;">
                        <h4 style="color: #2196F3; margin: 0 0 10px 0;">üîµ B-Rang (Lvl 25+)</h4>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em; color: #ccc;">
                            <li>Spezialisierung freischalten</li>
                            <li>6 Skill-Slots</li>
                            <li>Affinit√§t-Cap: 2</li>
                            <li>25% Malus, 20% Passive</li>
                        </ul>
                    </div>
                    <div style="background: rgba(156,39,176,0.2); padding: 15px; border-radius: 6px;">
                        <h4 style="color: #9C27B0; margin: 0 0 10px 0;">üü£ A-Rang (Lvl 40+)</h4>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em; color: #ccc;">
                            <li>2. Spezialisierungs-Level</li>
                            <li>7 Skill-Slots</li>
                            <li>Affinit√§t-Cap: 3</li>
                            <li>20% Malus, 35% Passive</li>
                        </ul>
                    </div>
                    <div style="background: rgba(244,67,54,0.2); padding: 15px; border-radius: 6px;">
                        <h4 style="color: #F44336; margin: 0 0 10px 0;">üî¥ S-Rang (Lvl 60+)</h4>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em; color: #ccc;">
                            <li>Meisterschaft</li>
                            <li>8 Skill-Slots</li>
                            <li>Affinit√§t-Cap: 3</li>
                            <li>15% Malus, 50% Passive</li>
                        </ul>
                    </div>
                    <div style="background: rgba(255,82,82,0.2); padding: 15px; border-radius: 6px;">
                        <h4 style="color: #ff5252; margin: 0 0 10px 0;">üü• SS-Rang (Lvl 80+)</h4>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em; color: #ccc;">
                            <li>Affinity Cap: 5 <span style="color: #FFD700;">(+Bonus m√∂glich)</span></li>
                            <li>9 Skill-Slots</li>
                            <li>10% Malus, 75% Passive</li>
                        </ul>
                    </div>
                    <div style="background: rgba(255,152,0,0.2); padding: 15px; border-radius: 6px; border: 2px solid #FF9800;">
                        <h4 style="color: #FF9800; margin: 0 0 10px 0;">üü•üü• SSS-Rang (Lvl 100+)</h4>
                        <ul style="margin: 0; padding-left: 20px; font-size: 0.9em; color: #fff; font-weight: bold;">
                            <li>KEIN Fremdskill-Malus!</li>
                            <li>Affinity Cap: 5 <span style="color: #FFD700;">(+Bonus m√∂glich)</span></li>
                            <li>10 Skill-Slots</li>
                            <li>100% Passive Bonus</li>
                        </ul>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Game Settings Panel -->
        <div class="admin-panel" id="panel-game-settings">
            <div class="panel-header">
                <h2 class="panel-title">‚öôÔ∏è Spieleinstellungen</h2>
            </div>
            
            <!-- Home City Change Cost -->
            <div style="background: rgba(255,215,0,0.1); border: 1px solid #FFD700; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                <h3 style="color: #FFD700; margin-bottom: 15px;">üè† Heimatstadt-Wechsel</h3>
                <div style="max-width: 600px;">
                    <div class="form-group">
                        <label class="form-label">Kosten (Goldm√ºnzen)</label>
                        <input type="number" class="form-input" id="home-change-cost" min="0" step="100">
                    </div>
                    <button class="btn" onclick="updateHomeChangeCost()">Kosten speichern</button>
                </div>
            </div>

            <!-- Gates Management -->
            <div style="background: rgba(220,53,69,0.1); border: 1px solid #dc3545; border-radius: 8px; padding: 20px; margin-bottom: 20px;">
                <h3 style="color: #dc3545; margin-bottom: 15px;">üåÄ Gates Management</h3>
                <div style="max-width: 600px;">
                    <!-- Gates Stats -->
                    <div id="gates-stats" style="background: rgba(26,31,46,0.5); border: 1px solid rgba(220,53,69,0.3); border-radius: 6px; padding: 15px; margin-bottom: 15px; font-size: 0.9rem;">
                        <div style="color: rgba(255,255,255,0.6);">‚è≥ Lade Gates-Statistiken...</div>
                    </div>
                    
                    <!-- Spawn Buttons -->
                    <div style="display: flex; gap: 10px; flex-wrap: wrap;">
                        <button class="btn" onclick="adminUI.spawnGates()" style="flex: 1; min-width: 150px;">üé≤ Gates Spawnen</button>
                        <button class="btn" onclick="adminUI.loadGatesStats()" style="flex: 1; min-width: 150px;">üîÑ Stats Aktualisieren</button>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- Database Panel -->
        <div class="admin-panel" id="panel-database">
            <div class="panel-header">
                <h2 class="panel-title">Datenbank</h2>
            </div>
            
            <!-- Backup Status -->
            <div style="background: rgba(0,212,255,0.1); border: 1px solid #00d4ff; border-radius: 8px; padding: 20px; margin-bottom: 30px;">
                <h3 style="color: #00d4ff; margin-bottom: 10px;">üìä Datenbank</h3>
                <p style="color: #aaa;">Alle Spieldaten werden in MySQL gespeichert. Verwende phpMyAdmin oder MySQL-Befehle f√ºr Backups.</p>
            </div>
        </div>

        <!-- Victory Builder Panel -->
        <div class="admin-panel" id="panel-victory-builder">
            <div class="panel-header">
                <h2 class="panel-title">üèÜ Victory Popup Builder - VOLLVERSION</h2>
                <div style="display: flex; gap: 10px;">
                    <button class="btn" onclick="saveVictoryBuilder()">üíæ Speichern</button>
                    <button class="btn" onclick="loadVictoryBuilder()">üìÇ Laden</button>
                    <button class="btn" style="background: #10b981;" onclick="previewVictory()">üëÅÔ∏è Vorschau</button>
                </div>
            </div>

            <div style="font-size: 12px; padding: 10px; background: rgba(255,215,0,0.1); border-radius: 6px; margin-bottom: 20px; color: #ffd700;">
                ‚ÑπÔ∏è <strong>Vollst√§ndiger Builder:</strong> Hintergrundbilder, XP/Gold-Anzeigen, Loot-Items, vollst√§ndige Anpassung
            </div>

            <link rel="preconnect" href="https://fonts.googleapis.com">
            <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
            <link href="https://fonts.googleapis.com/css2?family=Bangers&family=Bebas+Neue&family=Black+Ops+One&family=Cinzel:wght@700&family=Orbitron:wght@900&family=Russo+One&family=Roboto:wght@400;700&family=Montserrat:wght@400;700&family=Open+Sans:wght@400;700&family=Lato:wght@400;700&family=Poppins:wght@400;700&display=swap" rel="stylesheet">

            <div style="display: grid; grid-template-columns: 320px 1fr; gap: 20px;">
                <!-- Control Panel - ScrollArea -->
                <div style="background: rgba(0,0,0,0.3); border-radius: 12px; padding: 20px; overflow-y: auto; height: 800px;">
                    
                    <!-- Frame Upload -->
                    <h4 style="color: #00d4ff; margin-bottom: 12px;">üñºÔ∏è Hintergrundbild</h4>
                    <div style="margin-bottom: 20px;">
                        <input type="file" id="vb-frame-upload" accept="image/*" style="width: 100%; padding: 8px; background: rgba(0,0,0,0.5); border: 1px solid #00d4ff; border-radius: 4px; color: white; font-size: 12px;">
                        <button onclick="uploadVictoryBackground()" style="width: 100%; margin-top: 8px; padding: 6px; background: #10b981; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px;">üì§ Hochladen & Speichern</button>
                        <button onclick="document.getElementById('vb-frame-upload').value=''; document.getElementById('vb-victory-popup').style.backgroundImage='none';" style="width: 100%; margin-top: 4px; padding: 6px; background: #ff4444; color: white; border: none; border-radius: 4px; cursor: pointer; font-size: 11px;">üóëÔ∏è Bild entfernen</button>
                        <div id="vb-bg-status" style="margin-top: 8px; font-size: 11px;"></div>
                    </div>

                    <!-- Popup Size -->
                    <h4 style="color: #00d4ff; margin: 20px 0 12px;">üìê Popup-Gr√∂√üe</h4>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Breite <span id="vb-width-value">520px</span></label>
                        <input type="range" id="vb-popup-width" min="300" max="800" value="520" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">H√∂he <span id="vb-height-value">700px</span></label>
                        <input type="range" id="vb-popup-height" min="400" max="1000" value="700" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Padding <span id="vb-padding-value">40px</span></label>
                        <input type="range" id="vb-popup-padding" min="20" max="100" value="40" style="width: 100%;">
                    </div>

                    <!-- Title -->
                    <h4 style="color: #00d4ff; margin: 20px 0 12px;">üìù SIEG! Text</h4>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Schriftart</label>
                        <select id="vb-title-font" style="width: 100%; padding: 6px; background: rgba(0,0,0,0.5); border: 1px solid #00d4ff; border-radius: 4px; color: white; font-size: 12px;">
                            <option value="'Impact', sans-serif">Impact</option>
                            <option value="'Bebas Neue', sans-serif">Bebas Neue</option>
                            <option value="'Cinzel', serif">Cinzel</option>
                            <option value="'Orbitron', sans-serif">Orbitron</option>
                            <option value="'Russo One', sans-serif">Russo One</option>
                            <option value="'Bangers', cursive">Bangers</option>
                        </select>
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Text</label>
                        <input type="text" id="vb-title-text" value="SIEG!" style="width: 100%; padding: 6px; background: rgba(0,0,0,0.5); border: 1px solid #00d4ff; border-radius: 4px; color: white; font-size: 12px;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Gr√∂√üe <span id="vb-title-size-value">64px</span></label>
                        <input type="range" id="vb-title-size" min="24" max="120" value="64" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Farbe</label>
                        <input type="color" id="vb-title-color" value="#ffffff" style="width: 100%; height: 35px;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Schrift-Umrandung Dicke <span id="vb-title-stroke-value">0px</span></label>
                        <input type="range" id="vb-title-stroke" min="0" max="8" value="0" step="0.5" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Schrift-Umrandung Farbe</label>
                        <input type="color" id="vb-title-stroke-color" value="#000000" style="width: 100%; height: 35px;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Position Y <span id="vb-title-top-value">40px</span></label>
                        <input type="range" id="vb-title-top" min="-100" max="300" value="40" style="width: 100%;">
                    </div>

                    <!-- Subtitle -->
                    <h4 style="color: #00d4ff; margin: 20px 0 12px;">üìã Untertitel</h4>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Text</label>
                        <input type="text" id="vb-subtitle-text" value="Alle Gegner besiegt!" style="width: 100%; padding: 6px; background: rgba(0,0,0,0.5); border: 1px solid #00d4ff; border-radius: 4px; color: white; font-size: 12px;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Gr√∂√üe <span id="vb-subtitle-size-value">18px</span></label>
                        <input type="range" id="vb-subtitle-size" min="10" max="40" value="18" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Farbe</label>
                        <input type="color" id="vb-subtitle-color" value="#ffffff" style="width: 100%; height: 35px;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Position Y <span id="vb-subtitle-top-value">120px</span></label>
                        <input type="range" id="vb-subtitle-top" min="0" max="400" value="120" style="width: 100%;">
                    </div>

                    <!-- Rewards -->
                    <h4 style="color: #00d4ff; margin: 20px 0 12px;">üíé Belohnungen (XP & Gold)</h4>
                    <div style="font-size: 11px; padding: 8px; background: rgba(255,215,0,0.1); border-radius: 4px; margin-bottom: 12px; color: #ffd700;">
                        ‚ÑπÔ∏è Werte werden dynamisch berechnet (random + Faktoren)
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Position Y <span id="vb-rewards-top-value">170px</span></label>
                        <input type="range" id="vb-rewards-top" min="100" max="500" value="170" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Breite % <span id="vb-rewards-width-value">90%</span></label>
                        <input type="range" id="vb-rewards-width" min="50" max="100" value="90" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Item H√∂he <span id="vb-rewards-height-value">50px</span></label>
                        <input type="range" id="vb-rewards-height" min="30" max="80" value="50" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Transparenz <span id="vb-rewards-opacity-value">0.6</span></label>
                        <input type="range" id="vb-rewards-opacity" min="0" max="100" value="60" step="5" style="width: 100%;">
                    </div>

                    <!-- Loot Grid -->
                    <h4 style="color: #00d4ff; margin: 20px 0 12px;">üéÅ Loot Items</h4>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Position Y <span id="vb-loot-top-value">350px</span></label>
                        <input type="range" id="vb-loot-top" min="200" max="600" value="350" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Items pro Zeile <span id="vb-loot-columns-value">3</span></label>
                        <input type="range" id="vb-loot-columns" min="2" max="5" value="3" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Item Gr√∂√üe <span id="vb-loot-size-value">80px</span></label>
                        <input type="range" id="vb-loot-size" min="60" max="150" value="80" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Rahmenfarbe</label>
                        <input type="color" id="vb-loot-border" value="#d4af37" style="width: 100%; height: 35px;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Abstand <span id="vb-loot-gap-value">10px</span></label>
                        <input type="range" id="vb-loot-gap" min="4" max="30" value="10" style="width: 100%;">
                    </div>

                    <!-- Effects -->
                    <h4 style="color: #00d4ff; margin: 20px 0 12px;">‚ú® Effekte</h4>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Popup Transparenz <span id="vb-popup-opacity-value">1.0</span></label>
                        <input type="range" id="vb-popup-opacity" min="50" max="100" value="100" step="5" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Popup Rahmen Dicke <span id="vb-popup-border-value">0px</span></label>
                        <input type="range" id="vb-popup-border" min="0" max="10" value="0" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Popup Rahmen Farbe</label>
                        <input type="color" id="vb-popup-border-color" value="#d4af37" style="width: 100%; height: 35px;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Loot Hover Skalierung <span id="vb-loot-hover-value">1.1x</span></label>
                        <input type="range" id="vb-loot-hover" min="100" max="150" value="110" step="5" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 20px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Button Hover Lift <span id="vb-btn-hover-value">-2px</span></label>
                        <input type="range" id="vb-btn-hover" min="0" max="10" value="2" style="width: 100%;">
                    </div>

                    <!-- Buttons -->
                    <h4 style="color: #00d4ff; margin: 20px 0 12px;">üéÆ Buttons</h4>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Position von unten <span id="vb-buttons-bottom-value">40px</span></label>
                        <input type="range" id="vb-buttons-bottom" min="20" max="200" value="40" style="width: 100%;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Primary Farbe</label>
                        <input type="color" id="vb-btn-primary" value="#3b82f6" style="width: 100%; height: 35px;">
                    </div>
                    <div style="margin-bottom: 12px;">
                        <label style="display: block; margin-bottom: 6px; font-size: 13px;">Secondary Farbe</label>
                        <input type="color" id="vb-btn-secondary" value="#6b7280" style="width: 100%; height: 35px;">
                    </div>
                </div>

                <!-- Preview Area -->
                <div style="background: rgba(0,0,0,0.5); border-radius: 12px; padding: 20px; display: flex; align-items: center; justify-content: center; position: relative; height: 800px; overflow: hidden;">
                    <div style="position: absolute; top: 15px; left: 15px; color: #00d4ff; font-size: 14px; font-weight: bold;">üëÅÔ∏è Live Preview - Alle Elemente ziehbar!</div>
                    
                    <div id="vb-victory-popup" style="width: 520px; height: 700px; background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%); border-radius: 16px; position: relative; border: 3px solid #d4af37; box-shadow: 0 0 40px rgba(212, 175, 55, 0.3); padding: 40px; background-size: cover; background-position: center;">
                        
                        <!-- Title -->
                        <h1 id="vb-title-preview" style="position: absolute; top: 40px; left: 50%; transform: translateX(-50%); font-family: 'Impact', sans-serif; font-size: 64px; color: #ffffff; text-align: center; z-index: 10; margin: 0; text-shadow: 0 0 20px rgba(255,255,255,0.5); cursor: move;">SIEG!</h1>
                        
                        <!-- Subtitle -->
                        <p id="vb-subtitle-preview" style="position: absolute; top: 120px; left: 50%; transform: translateX(-50%); font-family: 'Arial', sans-serif; font-size: 18px; color: #ffffff; text-align: center; z-index: 10; margin: 0; cursor: move;">Alle Gegner besiegt!</p>
                        
                        <!-- Rewards Container -->
                        <div id="vb-rewards-container" style="position: absolute; top: 170px; left: 50%; transform: translateX(-50%); width: 90%; z-index: 10; cursor: move;">
                            <div style="display: flex; align-items: center; gap: 12px; padding: 12px 16px; margin-bottom: 10px; background: rgba(31, 41, 59, 0.6); border-left: 3px solid rgba(74, 144, 226, 0.6); border-radius: 6px;">
                                <div style="font-size: 24px;">‚≠ê</div>
                                <div style="flex: 1; font-size: 13px; font-weight: 600; color: #cbd5e1;">XP erhalten</div>
                                <div id="vb-exp-display" style="font-size: 18px; font-weight: bold; color: #fbbf24;">+25.000</div>
                            </div>
                            <div style="display: flex; align-items: center; gap: 12px; padding: 12px 16px; background: rgba(31, 41, 59, 0.6); border-left: 3px solid rgba(74, 144, 226, 0.6); border-radius: 6px;">
                                <div style="font-size: 24px;">üí∞</div>
                                <div style="flex: 1; font-size: 13px; font-weight: 600; color: #cbd5e1;">Goldm√ºnzen erhalten</div>
                                <div id="vb-gold-display" style="font-size: 18px; font-weight: bold; color: #fbbf24;">+15.000</div>
                            </div>
                        </div>
                        
                        <!-- Loot Grid -->
                        <div id="vb-loot-grid" style="position: absolute; top: 350px; left: 50%; transform: translateX(-50%); display: grid; grid-template-columns: repeat(3, 1fr); gap: 10px; z-index: 10; cursor: move;">
                            <div style="width: 80px; height: 80px; background: rgba(31, 41, 59, 0.8); border: 2px solid #d4af37; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 32px;">üíé</div>
                            <div style="width: 80px; height: 80px; background: rgba(31, 41, 59, 0.8); border: 2px solid #d4af37; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 32px;">‚öîÔ∏è</div>
                            <div style="width: 80px; height: 80px; background: rgba(31, 41, 59, 0.8); border: 2px solid #d4af37; border-radius: 8px; display: flex; align-items: center; justify-content: center; font-size: 32px;">üõ°Ô∏è</div>
                        </div>
                        
                        <!-- Buttons -->
                        <div id="vb-buttons-container" style="position: absolute; bottom: 40px; left: 50%; transform: translateX(-50%); display: flex; gap: 12px; z-index: 10; cursor: move;">
                            <button id="vb-btn-secondary-preview" style="padding: 12px 32px; border: none; border-radius: 8px; font-size: 14px; font-weight: bold; color: white; cursor: pointer; text-transform: uppercase; background: rgba(107, 114, 128, 0.8);">VERLASSEN</button>
                            <button id="vb-btn-primary-preview" style="padding: 12px 32px; border: none; border-radius: 8px; font-size: 14px; font-weight: bold; color: white; cursor: pointer; text-transform: uppercase; background: rgba(59, 130, 246, 0.8);">WEITER</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- UI Background Panel -->
        <div class="admin-panel" id="panel-ui-background">
            <div class="panel-header">
                <h2 class="panel-title">üñºÔ∏è UI-Hintergrund</h2>
            </div>
            
            <div style="max-width: 800px;">
                <!-- Current Background Preview -->
                <div style="background: rgba(149,117,255,0.1); border: 2px solid #9575ff; border-radius: 12px; padding: 25px; margin-bottom: 30px;">
                    <h3 style="color: #9575ff; margin-bottom: 15px; font-size: 18px;">üì∏ Aktueller Hintergrund</h3>
                    <div id="current-bg-preview" style="width: 100%; height: 300px; border-radius: 8px; background-size: cover; background-position: center; background-image: url('public/assets/sprites/Hintergrund.png'); box-shadow: 0 4px 12px rgba(0,0,0,0.5);"></div>
                    <p style="margin-top: 15px; opacity: 0.7; font-size: 14px;">Der aktuelle Hintergrund wird im gesamten UI verwendet.</p>
                </div>

                <!-- Upload New Background -->
                <div style="background: rgba(149,117,255,0.05); border: 1px solid #5a4a7f; border-radius: 12px; padding: 25px; margin-bottom: 20px;">
                    <h3 style="color: #9575ff; margin-bottom: 15px; font-size: 18px;">üì§ Neuen Hintergrund hochladen</h3>
                    <div class="form-group">
                        <label class="form-label">Hintergrundbild ausw√§hlen (PNG, JPG, WEBP)</label>
                        <input type="file" id="ui-bg-upload" accept="image/png,image/jpeg,image/jpg,image/webp" 
                               style="padding: 12px; background: rgba(26,31,46,0.8); border: 2px solid #5a4a7f; border-radius: 8px; color: #fff; width: 100%; cursor: pointer;">
                    </div>
                    
                    <!-- Preview Upload -->
                    <div id="upload-bg-preview-container" style="display: none; margin: 20px 0;">
                        <h4 style="color: #9575ff; margin-bottom: 10px; font-size: 16px;">Vorschau:</h4>
                        <div id="upload-bg-preview" style="width: 100%; height: 250px; border-radius: 8px; background-size: cover; background-position: center; box-shadow: 0 4px 12px rgba(0,0,0,0.5);"></div>
                    </div>
                    
                    <div id="bg-upload-status" style="margin-top: 15px; font-size: 14px;"></div>
                    
                    <button class="btn" onclick="uploadUIBackground()" style="margin-top: 15px; background: linear-gradient(135deg, #9575ff 0%, #7b5fd9 100%); border: none; padding: 12px 24px;">
                        ‚úÖ Hintergrund speichern
                    </button>
                </div>

                <!-- Reset to Default -->
                <div style="background: rgba(255,82,82,0.05); border: 1px solid #ff5252; border-radius: 12px; padding: 25px;">
                    <h3 style="color: #ff5252; margin-bottom: 15px; font-size: 18px;">üîÑ Auf Standard zur√ºcksetzen</h3>
                    <p style="margin-bottom: 15px; opacity: 0.8; font-size: 14px;">Setzt den Hintergrund auf das Standard-Bild "Hintergrund.png" zur√ºck.</p>
                    <button class="btn btn-danger" onclick="resetUIBackground()">
                        üóëÔ∏è Standard wiederherstellen
                    </button>
                </div>
            </div>
        </div>
    </div>
    
    <!-- Modal Container -->
    <div id="modal-container"></div>
    
    <script type="module" src="dist/admin.js?v=6"></script>
    <script>
        // ========== UI Background Upload Functions ==========
        // Preview uploaded background before saving
        document.getElementById('ui-bg-upload')?.addEventListener('change', function(e) {
            const file = e.target.files[0];
            const previewContainer = document.getElementById('upload-bg-preview-container');
            const preview = document.getElementById('upload-bg-preview');
            
            if (file && file.type.startsWith('image/')) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    preview.style.backgroundImage = `url('${e.target.result}')`;
                    previewContainer.style.display = 'block';
                };
                reader.readAsDataURL(file);
            } else {
                previewContainer.style.display = 'none';
            }
        });

        async function uploadUIBackground() {
            const fileInput = document.getElementById('ui-bg-upload');
            const statusDiv = document.getElementById('bg-upload-status');
            const currentPreview = document.getElementById('current-bg-preview');
            
            if (!fileInput.files || fileInput.files.length === 0) {
                statusDiv.innerHTML = '<span style="color: #ff5252;">‚ùå Bitte w√§hle zuerst ein Bild aus!</span>';
                return;
            }
            
            const file = fileInput.files[0];
            
            // Validate file size (max 10MB)
            if (file.size > 10 * 1024 * 1024) {
                statusDiv.innerHTML = '<span style="color: #ff5252;">‚ùå Datei zu gro√ü! Maximal 10MB erlaubt.</span>';
                return;
            }
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                statusDiv.innerHTML = '<span style="color: #ff5252;">‚ùå Ung√ºltiges Dateiformat! Nur Bilder (PNG, JPG, WEBP) erlaubt.</span>';
                return;
            }
            
            statusDiv.innerHTML = '<span style="color: #9575ff;">‚è≥ Wird hochgeladen...</span>';
            
            const formData = new FormData();
            formData.append('background', file);
            
            try {
                const response = await fetch('http://localhost:3001/api/admin/ui-background', {
                    method: 'POST',
                    body: formData
                });
                
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                
                if (data.success) {
                    // Update current preview
                    currentPreview.style.backgroundImage = `url('${data.url}')`;
                    
                    // Apply to main UI
                    applyUIBackground(data.url);
                    
                    // Save to localStorage
                    localStorage.setItem('customUIBackground', data.url);
                    
                    statusDiv.innerHTML = '<span style="color: #00ff88;">‚úÖ Hintergrund erfolgreich hochgeladen und aktiviert!</span>';
                    
                    // Reset file input
                    fileInput.value = '';
                    document.getElementById('upload-bg-preview-container').style.display = 'none';
                } else {
                    statusDiv.innerHTML = `<span style="color: #ff5252;">‚ùå Upload fehlgeschlagen: ${data.error || 'Unbekannter Fehler'}</span>`;
                }
            } catch (error) {
                console.error('Upload error:', error);
                statusDiv.innerHTML = `<span style="color: #ff5252;">‚ùå Upload fehlgeschlagen: ${error.message}</span>`;
            }
        }

        function resetUIBackground() {
            if (!confirm('M√∂chtest du den Hintergrund wirklich auf den Standard zur√ºcksetzen?')) {
                return;
            }
            
            const defaultBg = 'public/assets/sprites/Hintergrund.png';
            
            // Update current preview
            document.getElementById('current-bg-preview').style.backgroundImage = `url('${defaultBg}')`;
            
            // Apply to main UI
            applyUIBackground(defaultBg);
            
            // Remove from localStorage
            localStorage.removeItem('customUIBackground');
            
            document.getElementById('bg-upload-status').innerHTML = '<span style="color: #00ff88;">‚úÖ Standard-Hintergrund wiederhergestellt!</span>';
        }

        function applyUIBackground(url) {
            // Set CSS custom property for background
            document.documentElement.style.setProperty('--custom-background', `url('${url}')`);
        }

        // Load custom background on page load
        window.addEventListener('DOMContentLoaded', function() {
            const savedBg = localStorage.getItem('customUIBackground');
            if (savedBg) {
                applyUIBackground(savedBg);
                document.getElementById('current-bg-preview').style.backgroundImage = `url('${savedBg}')`;
            }
        });

        // ========== World Map Upload Functions ==========
        async function uploadWorldMap() {
            const fileInput = document.getElementById('world-map-upload');
            const statusDiv = document.getElementById('upload-status');
            const preview = document.getElementById('world-map-preview');
            
            if (!fileInput.files || fileInput.files.length === 0) {
                statusDiv.innerHTML = '<span style="color: #ff5252;">‚ùå Bitte w√§hle zuerst ein Bild aus!</span>';
                return;
            }
            
            const file = fileInput.files[0];
            
            // Validate file size
            if (file.size > 10 * 1024 * 1024) {
                statusDiv.innerHTML = '<span style="color: #ff5252;">‚ùå Datei zu gro√ü! Maximal 10MB erlaubt.</span>';
                return;
            }
            
            // Validate file type
            if (!file.type.startsWith('image/')) {
                statusDiv.innerHTML = '<span style="color: #ff5252;">‚ùå Ung√ºltiges Dateiformat! Nur Bilder erlaubt.</span>';
                return;
            }
            
            const formData = new FormData();
            formData.append('worldmap', file);
            
            statusDiv.innerHTML = '<span style="color: #FFC107;">‚è≥ Lade Bild hoch...</span>';
            
            try {
                const response = await fetch('http://localhost:3001/api/admin/upload-world-map', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (response.ok) {
                    statusDiv.innerHTML = '<span style="color: #4CAF50;">‚úÖ ' + result.message + '</span>';
                    
                    // Update preview
                    preview.src = result.imageUrl + '?t=' + Date.now();
                    
                    // Clear file input
                    fileInput.value = '';
                } else {
                    statusDiv.innerHTML = '<span style="color: #ff5252;">‚ùå ' + result.error + '</span>';
                }
            } catch (error) {
                console.error('Upload error:', error);
                statusDiv.innerHTML = '<span style="color: #ff5252;">‚ùå Upload fehlgeschlagen: ' + error.message + '</span>';
            }
        }
        
        // Load current world map on page load
        async function loadCurrentWorldMap() {
            try {
                const response = await fetch('http://localhost:3001/api/admin/world-map-image');
                const data = await response.json();
                
                if (data.imageUrl) {
                    document.getElementById('world-map-preview').src = data.imageUrl + '?t=' + Date.now();
                }
            } catch (error) {
                console.error('Error loading world map:', error);
            }
        }
        
        // Load on page ready
        document.addEventListener('DOMContentLoaded', loadCurrentWorldMap);

        // ========== Victory Builder Functions ==========
        
        // Initialize Victory Builder
        function initVictoryBuilder() {
            const popup = document.getElementById('vb-victory-popup');
            const titlePreview = document.getElementById('vb-title-preview');
            const subtitlePreview = document.getElementById('vb-subtitle-preview');
            const rewardsContainer = document.getElementById('vb-rewards-container');
            const lootGrid = document.getElementById('vb-loot-grid');
            const buttonsContainer = document.getElementById('vb-buttons-container');
            const primaryBtn = document.getElementById('vb-btn-primary-preview');
            const secondaryBtn = document.getElementById('vb-btn-secondary-preview');
            const expDisplay = document.getElementById('vb-exp-display');
            const goldDisplay = document.getElementById('vb-gold-display');

            // Frame Upload
            document.getElementById('vb-frame-upload').addEventListener('change', (e) => {
                const file = e.target.files[0];
                if (file) {
                    const reader = new FileReader();
                    reader.onload = (event) => {
                        popup.style.backgroundImage = `url(${event.target.result})`;
                    };
                    reader.readAsDataURL(file);
                }
            });

            // Width
            document.getElementById('vb-popup-width').addEventListener('input', (e) => {
                const value = e.target.value + 'px';
                popup.style.width = value;
                document.getElementById('vb-width-value').textContent = value;
            });

            // Height
            document.getElementById('vb-popup-height').addEventListener('input', (e) => {
                const value = e.target.value + 'px';
                popup.style.height = value;
                document.getElementById('vb-height-value').textContent = value;
            });

            // Padding
            document.getElementById('vb-popup-padding').addEventListener('input', (e) => {
                const value = e.target.value + 'px';
                popup.style.padding = value;
                document.getElementById('vb-padding-value').textContent = value;
            });

            // Title Font
            document.getElementById('vb-title-font').addEventListener('change', (e) => {
                titlePreview.style.fontFamily = e.target.value;
            });

            // Title Text
            document.getElementById('vb-title-text').addEventListener('input', (e) => {
                titlePreview.textContent = e.target.value;
            });

            // Title Size
            document.getElementById('vb-title-size').addEventListener('input', (e) => {
                const value = e.target.value + 'px';
                titlePreview.style.fontSize = value;
                document.getElementById('vb-title-size-value').textContent = value;
            });

            // Title Color
            document.getElementById('vb-title-color').addEventListener('input', (e) => {
                titlePreview.style.color = e.target.value;
            });

            // Title Top
            document.getElementById('vb-title-top').addEventListener('input', (e) => {
                const value = e.target.value + 'px';
                titlePreview.style.top = value;
                document.getElementById('vb-title-top-value').textContent = value;
            });

            // Title Stroke
            document.getElementById('vb-title-stroke').addEventListener('input', (e) => {
                const width = e.target.value + 'px';
                const color = document.getElementById('vb-title-stroke-color').value;
                if (parseFloat(e.target.value) > 0) {
                    titlePreview.style.webkitTextStroke = `${width} ${color}`;
                    titlePreview.style.textShadow = `0 0 20px rgba(255,255,255,0.5), 0 0 4px ${color}`;
                } else {
                    titlePreview.style.webkitTextStroke = 'none';
                    titlePreview.style.textShadow = '0 0 20px rgba(255,255,255,0.5)';
                }
                document.getElementById('vb-title-stroke-value').textContent = width;
            });

            // Title Stroke Color
            document.getElementById('vb-title-stroke-color').addEventListener('input', (e) => {
                const color = e.target.value;
                const width = document.getElementById('vb-title-stroke').value + 'px';
                if (parseFloat(document.getElementById('vb-title-stroke').value) > 0) {
                    titlePreview.style.webkitTextStroke = `${width} ${color}`;
                    titlePreview.style.textShadow = `0 0 20px rgba(255,255,255,0.5), 0 0 4px ${color}`;
                }
            });

            // Subtitle Text
            document.getElementById('vb-subtitle-text').addEventListener('input', (e) => {
                subtitlePreview.textContent = e.target.value;
            });

            // Subtitle Size
            document.getElementById('vb-subtitle-size').addEventListener('input', (e) => {
                const value = e.target.value + 'px';
                subtitlePreview.style.fontSize = value;
                document.getElementById('vb-subtitle-size-value').textContent = value;
            });

            // Subtitle Color
            document.getElementById('vb-subtitle-color').addEventListener('input', (e) => {
                subtitlePreview.style.color = e.target.value;
            });

            // Subtitle Top
            document.getElementById('vb-subtitle-top').addEventListener('input', (e) => {
                const value = e.target.value + 'px';
                subtitlePreview.style.top = value;
                document.getElementById('vb-subtitle-top-value').textContent = value;
            });

            // Button Primary Color
            document.getElementById('vb-btn-primary').addEventListener('input', (e) => {
                const color = e.target.value;
                primaryBtn.style.background = color + 'cc'; // Add alpha
            });

            // Button Secondary Color
            document.getElementById('vb-btn-secondary').addEventListener('input', (e) => {
                const color = e.target.value;
                secondaryBtn.style.background = color + 'cc'; // Add alpha
            });

            // Buttons Bottom
            document.getElementById('vb-buttons-bottom').addEventListener('input', (e) => {
                const value = e.target.value + 'px';
                buttonsContainer.style.bottom = value;
                document.getElementById('vb-buttons-bottom-value').textContent = value;
            });

            // Rewards Top
            document.getElementById('vb-rewards-top').addEventListener('input', (e) => {
                const value = e.target.value + 'px';
                rewardsContainer.style.top = value;
                document.getElementById('vb-rewards-top-value').textContent = value;
            });

            // Rewards Width
            document.getElementById('vb-rewards-width').addEventListener('input', (e) => {
                const value = e.target.value + '%';
                rewardsContainer.style.width = value;
                document.getElementById('vb-rewards-width-value').textContent = value;
            });

            // Rewards Height
            document.getElementById('vb-rewards-height').addEventListener('input', (e) => {
                const value = e.target.value + 'px';
                const rows = rewardsContainer.querySelectorAll('.reward-row');
                rows.forEach(row => row.style.height = value);
                document.getElementById('vb-rewards-height-value').textContent = value;
            });

            // Rewards Opacity
            document.getElementById('vb-rewards-opacity').addEventListener('input', (e) => {
                const value = (e.target.value / 100).toFixed(1);
                const rows = rewardsContainer.querySelectorAll('.reward-row');
                rows.forEach(row => {
                    row.style.opacity = value;
                });
                document.getElementById('vb-rewards-opacity-value').textContent = value;
            });

            // Popup Opacity
            document.getElementById('vb-popup-opacity').addEventListener('input', (e) => {
                const value = (e.target.value / 100).toFixed(1);
                popup.style.opacity = value;
                document.getElementById('vb-popup-opacity-value').textContent = value;
            });

            // Popup Border
            document.getElementById('vb-popup-border').addEventListener('input', (e) => {
                const width = e.target.value + 'px';
                const color = document.getElementById('vb-popup-border-color').value;
                popup.style.border = parseFloat(e.target.value) > 0 ? `${width} solid ${color}` : 'none';
                document.getElementById('vb-popup-border-value').textContent = width;
            });

            // Popup Border Color
            document.getElementById('vb-popup-border-color').addEventListener('input', (e) => {
                const color = e.target.value;
                const width = document.getElementById('vb-popup-border').value + 'px';
                if (parseFloat(document.getElementById('vb-popup-border').value) > 0) {
                    popup.style.borderColor = color;
                }
            });

            // Loot Hover Scale
            document.getElementById('vb-loot-hover').addEventListener('input', (e) => {
                const value = (e.target.value / 100).toFixed(1);
                document.getElementById('vb-loot-hover-value').textContent = value + 'x';
                // Apply via CSS variable or inline style
                document.querySelectorAll('.loot-item').forEach(item => {
                    item.style.setProperty('--hover-scale', value);
                });
            });

            // Button Hover Lift
            document.getElementById('vb-btn-hover').addEventListener('input', (e) => {
                const value = e.target.value;
                document.getElementById('vb-btn-hover-value').textContent = '-' + value + 'px';
                document.querySelectorAll('.victory-btn').forEach(btn => {
                    btn.style.setProperty('--hover-lift', '-' + value + 'px');
                });
            });

            // Loot Top
            document.getElementById('vb-loot-top').addEventListener('input', (e) => {
                const value = e.target.value + 'px';
                lootGrid.style.top = value;
                document.getElementById('vb-loot-top-value').textContent = value;
            });

            // Loot Columns
            document.getElementById('vb-loot-columns').addEventListener('input', (e) => {
                const value = e.target.value;
                lootGrid.style.gridTemplateColumns = `repeat(${value}, 1fr)`;
                document.getElementById('vb-loot-columns-value').textContent = value;
            });

            // Loot Size
            document.getElementById('vb-loot-size').addEventListener('input', (e) => {
                const value = e.target.value + 'px';
                const items = lootGrid.querySelectorAll('div');
                items.forEach(item => {
                    item.style.width = value;
                    item.style.height = value;
                });
                document.getElementById('vb-loot-size-value').textContent = value;
            });

            // Loot Border
            document.getElementById('vb-loot-border').addEventListener('input', (e) => {
                const color = e.target.value;
                const items = lootGrid.querySelectorAll('div');
                items.forEach(item => {
                    item.style.borderColor = color;
                });
            });

            // Loot Gap
            document.getElementById('vb-loot-gap').addEventListener('input', (e) => {
                const value = e.target.value + 'px';
                lootGrid.style.gap = value;
                document.getElementById('vb-loot-gap-value').textContent = value;
            });

            // Load saved settings
            loadVictoryBuilder();
        }

        async function saveVictoryBuilder() {
            const popup = document.getElementById('vb-victory-popup');
            const backgroundImage = popup.style.backgroundImage || '';
            
            const settings = {
                popupWidth: document.getElementById('vb-popup-width').value,
                popupHeight: document.getElementById('vb-popup-height').value,
                popupPadding: document.getElementById('vb-popup-padding').value,
                popupOpacity: (document.getElementById('vb-popup-opacity').value / 100).toFixed(1),
                popupBorder: document.getElementById('vb-popup-border').value,
                popupBorderColor: document.getElementById('vb-popup-border-color').value,
                // backgroundImage: backgroundImage, // NICHT SPEICHERN - zu gro√ü f√ºr MySQL
                titleFont: document.getElementById('vb-title-font').value,
                titleText: document.getElementById('vb-title-text').value,
                titleSize: document.getElementById('vb-title-size').value,
                titleColor: document.getElementById('vb-title-color').value,
                titleTop: document.getElementById('vb-title-top').value,
                titleStroke: document.getElementById('vb-title-stroke').value,
                titleStrokeColor: document.getElementById('vb-title-stroke-color').value,
                subtitleText: document.getElementById('vb-subtitle-text').value,
                subtitleSize: document.getElementById('vb-subtitle-size').value,
                subtitleColor: document.getElementById('vb-subtitle-color').value,
                subtitleTop: document.getElementById('vb-subtitle-top').value,
                rewardsTop: document.getElementById('vb-rewards-top').value,
                rewardsWidth: document.getElementById('vb-rewards-width').value,
                rewardsHeight: document.getElementById('vb-rewards-height').value,
                rewardsOpacity: (document.getElementById('vb-rewards-opacity').value / 100).toFixed(1),
                lootTop: document.getElementById('vb-loot-top').value,
                lootColumns: document.getElementById('vb-loot-columns').value,
                lootSize: document.getElementById('vb-loot-size').value,
                lootBorder: document.getElementById('vb-loot-border').value,
                lootGap: document.getElementById('vb-loot-gap').value,
                lootHover: (document.getElementById('vb-loot-hover').value / 100).toFixed(1),
                btnPrimary: document.getElementById('vb-btn-primary').value,
                btnSecondary: document.getElementById('vb-btn-secondary').value,
                buttonsBottom: document.getElementById('vb-buttons-bottom').value,
                btnHover: document.getElementById('vb-btn-hover').value
            };

            // Hinweis: Hintergrundbild muss separat hochgeladen werden
            const cssCode = generateVictoryCSS(settings);

            try {
                const response = await fetch('http://localhost:3001/api/admin/victory-builder/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        settingName: 'default',
                        cssCode: cssCode,
                        settings: settings
                    })
                });

                const result = await response.json();
                if (result.success) {
                    alert('‚úÖ Victory Builder Einstellungen gespeichert!\n\nHinweis: Hintergrundbild wird nicht gespeichert (nur f√ºr Preview).');
                } else {
                    alert('‚ùå Fehler: ' + result.error);
                }
            } catch (error) {
                console.error('Save error:', error);
                alert('‚ùå Speichern fehlgeschlagen!');
            }
        }

        async function loadVictoryBuilder() {
            try {
                const response = await fetch('http://localhost:3001/api/admin/victory-builder/load/default');
                const data = await response.json();

                if (data.settings && Object.keys(data.settings).length > 0) {
                    const s = data.settings;
                    
                    // Apply settings
                    if (s.popupWidth) {
                        document.getElementById('vb-popup-width').value = s.popupWidth;
                        document.getElementById('vb-popup-width').dispatchEvent(new Event('input'));
                    }
                    if (s.popupHeight) {
                        document.getElementById('vb-popup-height').value = s.popupHeight;
                        document.getElementById('vb-popup-height').dispatchEvent(new Event('input'));
                    }
                    if (s.titleFont) {
                        document.getElementById('vb-title-font').value = s.titleFont;
                        document.getElementById('vb-title-font').dispatchEvent(new Event('change'));
                    }
                    if (s.titleText) {
                        document.getElementById('vb-title-text').value = s.titleText;
                        document.getElementById('vb-title-text').dispatchEvent(new Event('input'));
                    }
                    if (s.titleSize) {
                        document.getElementById('vb-title-size').value = s.titleSize;
                        document.getElementById('vb-title-size').dispatchEvent(new Event('input'));
                    }
                    if (s.titleColor) {
                        document.getElementById('vb-title-color').value = s.titleColor;
                        document.getElementById('vb-title-color').dispatchEvent(new Event('input'));
                    }
                    if (s.titleTop) {
                        document.getElementById('vb-title-top').value = s.titleTop;
                        document.getElementById('vb-title-top').dispatchEvent(new Event('input'));
                    }
                    if (s.titleStroke) {
                        document.getElementById('vb-title-stroke').value = s.titleStroke;
                        document.getElementById('vb-title-stroke').dispatchEvent(new Event('input'));
                    }
                    if (s.titleStrokeColor) {
                        document.getElementById('vb-title-stroke-color').value = s.titleStrokeColor;
                        document.getElementById('vb-title-stroke-color').dispatchEvent(new Event('input'));
                    }
                    if (s.subtitleText) {
                        document.getElementById('vb-subtitle-text').value = s.subtitleText;
                        document.getElementById('vb-subtitle-text').dispatchEvent(new Event('input'));
                    }
                    if (s.subtitleSize) {
                        document.getElementById('vb-subtitle-size').value = s.subtitleSize;
                        document.getElementById('vb-subtitle-size').dispatchEvent(new Event('input'));
                    }
                    if (s.subtitleColor) {
                        document.getElementById('vb-subtitle-color').value = s.subtitleColor;
                        document.getElementById('vb-subtitle-color').dispatchEvent(new Event('input'));
                    }
                    if (s.subtitleTop) {
                        document.getElementById('vb-subtitle-top').value = s.subtitleTop;
                        document.getElementById('vb-subtitle-top').dispatchEvent(new Event('input'));
                    }
                    if (s.btnPrimary) {
                        document.getElementById('vb-btn-primary').value = s.btnPrimary;
                        document.getElementById('vb-btn-primary').dispatchEvent(new Event('input'));
                    }
                    if (s.btnSecondary) {
                        document.getElementById('vb-btn-secondary').value = s.btnSecondary;
                        document.getElementById('vb-btn-secondary').dispatchEvent(new Event('input'));
                    }
                    if (s.buttonsBottom) {
                        document.getElementById('vb-buttons-bottom').value = s.buttonsBottom;
                        document.getElementById('vb-buttons-bottom').dispatchEvent(new Event('input'));
                    }
                    if (s.popupPadding) {
                        document.getElementById('vb-popup-padding').value = s.popupPadding;
                        document.getElementById('vb-popup-padding').dispatchEvent(new Event('input'));
                    }
                    if (s.rewardsTop) {
                        document.getElementById('vb-rewards-top').value = s.rewardsTop;
                        document.getElementById('vb-rewards-top').dispatchEvent(new Event('input'));
                    }
                    if (s.rewardsWidth) {
                        document.getElementById('vb-rewards-width').value = s.rewardsWidth;
                        document.getElementById('vb-rewards-width').dispatchEvent(new Event('input'));
                    }
                    if (s.rewardsHeight) {
                        document.getElementById('vb-rewards-height').value = s.rewardsHeight;
                        document.getElementById('vb-rewards-height').dispatchEvent(new Event('input'));
                    }
                    if (s.rewardsOpacity) {
                        document.getElementById('vb-rewards-opacity').value = s.rewardsOpacity * 100;
                        document.getElementById('vb-rewards-opacity').dispatchEvent(new Event('input'));
                    }
                    if (s.popupOpacity) {
                        document.getElementById('vb-popup-opacity').value = s.popupOpacity * 100;
                        document.getElementById('vb-popup-opacity').dispatchEvent(new Event('input'));
                    }
                    if (s.lootHover) {
                        document.getElementById('vb-loot-hover').value = s.lootHover * 100;
                        document.getElementById('vb-loot-hover').dispatchEvent(new Event('input'));
                    }
                    if (s.btnHover) {
                        document.getElementById('vb-btn-hover').value = s.btnHover;
                        document.getElementById('vb-btn-hover').dispatchEvent(new Event('input'));
                    }
                    if (s.lootTop) {
                        document.getElementById('vb-loot-top').value = s.lootTop;
                        document.getElementById('vb-loot-top').dispatchEvent(new Event('input'));
                    }
                    if (s.lootColumns) {
                        document.getElementById('vb-loot-columns').value = s.lootColumns;
                        document.getElementById('vb-loot-columns').dispatchEvent(new Event('input'));
                    }
                    if (s.lootSize) {
                        document.getElementById('vb-loot-size').value = s.lootSize;
                        document.getElementById('vb-loot-size').dispatchEvent(new Event('input'));
                    }
                    if (s.lootBorder) {
                        document.getElementById('vb-loot-border').value = s.lootBorder;
                        document.getElementById('vb-loot-border').dispatchEvent(new Event('input'));
                    }
                    if (s.lootGap) {
                        document.getElementById('vb-loot-gap').value = s.lootGap;
                        document.getElementById('vb-loot-gap').dispatchEvent(new Event('input'));
                    }
                    if (s.backgroundImage) {
                        document.getElementById('vb-victory-popup').style.backgroundImage = s.backgroundImage;
                    }
                    
                    console.log('‚úÖ Victory Builder Einstellungen geladen');
                }
            } catch (error) {
                console.error('Load error:', error);
            }
        }

        function generateVictoryCSS(settings) {
            return `
/* Victory Popup Styles - Generiert vom Admin Panel */
.victory-popup {
    width: ${settings.popupWidth}px;
    height: ${settings.popupHeight}px;
    padding: ${settings.popupPadding}px;
    background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
    background-size: cover;
    background-position: center;
    border-radius: 16px;
    position: relative;
    ${settings.popupBorder && parseFloat(settings.popupBorder) > 0 ? `border: ${settings.popupBorder}px solid ${settings.popupBorderColor || '#d4af37'};` : 'border: none;'}
    box-shadow: 0 0 40px rgba(0, 0, 0, 0.5);
    opacity: ${settings.popupOpacity || 1.0};
}

.victory-title {
    position: absolute;
    top: ${settings.titleTop}px;
    left: 50%;
    transform: translateX(-50%);
    font-family: ${settings.titleFont};
    font-size: ${settings.titleSize}px;
    color: ${settings.titleColor};
    text-align: center;
    z-index: 10;
    margin: 0;
    ${settings.titleStroke && parseFloat(settings.titleStroke) > 0 ? `
    -webkit-text-stroke: ${settings.titleStroke}px ${settings.titleStrokeColor || '#000000'};
    text-shadow: 0 0 20px rgba(255,255,255,0.5), 0 0 4px ${settings.titleStrokeColor || '#000000'};
    ` : `
    text-shadow: 0 0 20px rgba(255,255,255,0.5);
    `}
}

.victory-subtitle {
    position: absolute;
    top: ${settings.subtitleTop}px;
    left: 50%;
    transform: translateX(-50%);
    font-family: 'Arial', sans-serif;
    font-size: ${settings.subtitleSize}px;
    color: ${settings.subtitleColor};
    text-align: center;
    z-index: 10;
    margin: 0;
}

.rewards-container {
    position: absolute;
    top: ${settings.rewardsTop}px;
    left: 50%;
    transform: translateX(-50%);
    width: ${settings.rewardsWidth || 90}%;
    z-index: 10;
}

.reward-row {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 12px 16px;
    margin-bottom: 10px;
    height: ${settings.rewardsHeight || 50}px;
    background: rgba(31, 41, 59, 0.6);
    border-left: 3px solid rgba(74, 144, 226, 0.6);
    border-radius: 6px;
    opacity: ${settings.rewardsOpacity || 0.6};
    transition: opacity 0.3s;
}

.reward-row:hover {
    opacity: 1;
}

.loot-grid {
    position: absolute;
    top: ${settings.lootTop}px;
    left: 50%;
    transform: translateX(-50%);
    display: grid;
    grid-template-columns: repeat(${settings.lootColumns}, 1fr);
    gap: ${settings.lootGap}px;
    z-index: 10;
}

.loot-item {
    width: ${settings.lootSize}px;
    height: ${settings.lootSize}px;
    background: rgba(31, 41, 59, 0.8);
    border: 2px solid ${settings.lootBorder};
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 32px;
    cursor: pointer;
    transition: all 0.3s;
}

.loot-item:hover {
    transform: scale(${settings.lootHover || 1.1});
    box-shadow: 0 0 20px ${settings.lootBorder}80;
}

.victory-buttons {
    position: absolute;
    bottom: ${settings.buttonsBottom}px;
    left: 50%;
    transform: translateX(-50%);
    display: flex;
    gap: 12px;
    z-index: 10;
}

.victory-btn {
    padding: 12px 32px;
    border: none;
    border-radius: 8px;
    font-size: 14px;
    font-weight: bold;
    color: white;
    cursor: pointer;
    text-transform: uppercase;
    transition: all 0.3s;
}

.victory-btn:hover {
    transform: translateY(${settings.btnHover ? '-' + settings.btnHover + 'px' : '-2px'});
    box-shadow: 0 5px 15px rgba(0, 0, 0, 0.3);
}

.victory-btn.primary {
    background: ${settings.btnPrimary}cc;
}

.victory-btn.secondary {
    background: ${settings.btnSecondary}cc;
}
`;
        }

        function previewVictory() {
            const popup = document.getElementById('vb-victory-popup').cloneNode(true);
            const overlay = document.createElement('div');
            overlay.style.cssText = 'position: fixed; top: 0; left: 0; right: 0; bottom: 0; background: rgba(0,0,0,0.9); z-index: 10000; display: flex; align-items: center; justify-content: center;';
            overlay.appendChild(popup);
            overlay.onclick = () => overlay.remove();
            document.body.appendChild(overlay);
        }

        // Make functions globally accessible
        window.saveVictoryBuilder = saveVictoryBuilder;
        window.loadVictoryBuilder = loadVictoryBuilder;
        window.previewVictory = previewVictory;
        window.initVictoryBuilder = initVictoryBuilder;
        window.generateVictoryCSS = generateVictoryCSS;
        window.uploadVictoryBackground = uploadVictoryBackground;
        window.loadVictoryBackground = loadVictoryBackground;

        // Upload Victory Background
        async function uploadVictoryBackground() {
            const fileInput = document.getElementById('vb-frame-upload');
            const statusDiv = document.getElementById('vb-bg-status');
            
            if (!fileInput.files || !fileInput.files[0]) {
                statusDiv.innerHTML = '<span style="color: #ff5252;">‚ùå Bitte w√§hle ein Bild aus</span>';
                return;
            }
            
            const formData = new FormData();
            formData.append('background', fileInput.files[0]);
            
            statusDiv.innerHTML = '<span style="color: #ffd700;">‚è≥ Lade hoch...</span>';
            
            try {
                const response = await fetch('http://localhost:3001/api/admin/victory-builder/upload-background', {
                    method: 'POST',
                    body: formData
                });
                
                const result = await response.json();
                
                if (result.success) {
                    statusDiv.innerHTML = '<span style="color: #10b981;">‚úÖ ' + result.message + '</span>';
                    // Set background in preview
                    const popup = document.getElementById('vb-victory-popup');
                    popup.style.backgroundImage = `url(${result.imageUrl})`;
                    popup.style.backgroundSize = 'cover';
                    popup.style.backgroundPosition = 'center';
                } else {
                    statusDiv.innerHTML = '<span style="color: #ff5252;">‚ùå ' + result.error + '</span>';
                }
            } catch (error) {
                console.error('Upload error:', error);
                statusDiv.innerHTML = '<span style="color: #ff5252;">‚ùå Upload fehlgeschlagen</span>';
            }
        }
        
        // Load Victory Background
        async function loadVictoryBackground() {
            try {
                const response = await fetch('http://localhost:3001/api/admin/victory-builder/background');
                const data = await response.json();
                
                if (data.imageUrl) {
                    const popup = document.getElementById('vb-victory-popup');
                    popup.style.backgroundImage = `url(${data.imageUrl})`;
                    popup.style.backgroundSize = 'cover';
                    popup.style.backgroundPosition = 'center';
                }
            } catch (error) {
                console.error('Background load error:', error);
            }
        }

        // Initialize when panel becomes active
        document.addEventListener('DOMContentLoaded', () => {
            const victoryTab = document.querySelector('[data-tab="victory-builder"]');
            if (victoryTab) {
                victoryTab.addEventListener('click', () => {
                    setTimeout(() => {
                        initVictoryBuilder();
                        loadVictoryBuilder();
                        loadVictoryBackground();
                    }, 100);
                });
            }
        });

        // ========== Game Settings Functions ==========
        async function loadHomeChangeCost() {
            try {
                const response = await fetch('/api/cities/home-change-cost');
                const data = await response.json();
                document.getElementById('home-change-cost').value = data.cost || 10000;
            } catch (error) {
                console.error('Error loading home change cost:', error);
                document.getElementById('home-change-cost').value = 10000;
            }
        }

        async function updateHomeChangeCost() {
            const cost = parseInt(document.getElementById('home-change-cost').value);
            
            if (isNaN(cost) || cost < 0) {
                alert('Bitte gib einen g√ºltigen Wert ein (mindestens 0)!');
                return;
            }
            
            try {
                const response = await fetch('/api/cities/admin/home-change-cost', {
                    method: 'PUT',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ cost })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    alert(`‚úÖ Heimatstadt-Wechselkosten auf ${cost} Goldm√ºnzen aktualisiert!`);
                } else {
                    alert('‚ùå Fehler: ' + data.message);
                }
            } catch (error) {
                console.error('Error updating home change cost:', error);
                alert('‚ùå Fehler beim Speichern der Einstellungen!');
            }
        }

        // ========== Login Layout Editor Functions ==========
        function applyLoginLayout() {
            const settings = {
                titleText: document.getElementById('login-title-text').value,
                titleSize: document.getElementById('login-title-size').value,
                titleColor1: document.getElementById('login-title-color1').value,
                titleColor2: document.getElementById('login-title-color2').value,
                inputSize: document.getElementById('login-input-size').value,
                inputBorder: document.getElementById('login-input-border').value,
                inputPadding: document.getElementById('login-input-padding').value,
                btnText: document.getElementById('login-btn-text').value,
                btnSize: document.getElementById('login-btn-size').value,
                btnColor1: document.getElementById('login-btn-color1').value,
                btnColor2: document.getElementById('login-btn-color2').value,
                maxWidth: document.getElementById('login-max-width').value,
                marginTop: document.getElementById('login-margin-top').value,
                animPortal: document.getElementById('anim-portal').checked,
                animDragon: document.getElementById('anim-dragon').checked,
                animSword: document.getElementById('anim-sword').checked,
                animLightning: document.getElementById('anim-lightning').checked,
                animFrame: document.getElementById('anim-frame').checked
            };

            // Update preview
            updatePreview(settings);

            // Save to localStorage
            localStorage.setItem('loginLayoutSettings', JSON.stringify(settings));

            // Apply CSS custom properties
            const root = document.documentElement;
            root.style.setProperty('--login-title-text', `"${settings.titleText}"`);
            root.style.setProperty('--login-title-size', settings.titleSize + 'px');
            root.style.setProperty('--login-title-color1', settings.titleColor1);
            root.style.setProperty('--login-title-color2', settings.titleColor2);
            root.style.setProperty('--login-input-size', settings.inputSize + 'px');
            root.style.setProperty('--login-input-border', settings.inputBorder);
            root.style.setProperty('--login-input-padding', settings.inputPadding + 'px');
            root.style.setProperty('--login-btn-text', `"${settings.btnText}"`);
            root.style.setProperty('--login-btn-size', settings.btnSize + 'px');
            root.style.setProperty('--login-btn-color1', settings.btnColor1);
            root.style.setProperty('--login-btn-color2', settings.btnColor2);
            root.style.setProperty('--login-max-width', settings.maxWidth + 'px');
            root.style.setProperty('--login-margin-top', settings.marginTop + 'px');

            alert('‚úÖ Login-Layout wurde erfolgreich angewendet!\n\nDie √Ñnderungen werden auf der Login-Seite sichtbar.');
        }

        function updatePreview(settings) {
            const previewTitle = document.getElementById('preview-title');
            const previewInput = document.getElementById('preview-input');
            const previewBtn = document.getElementById('preview-btn');
            const previewContainer = document.getElementById('preview-container');

            // Update title
            previewTitle.textContent = settings.titleText;
            previewTitle.style.fontSize = settings.titleSize + 'px';
            previewTitle.style.background = `linear-gradient(135deg, ${settings.titleColor1}, ${settings.titleColor2})`;
            previewTitle.style.webkitBackgroundClip = 'text';
            previewTitle.style.webkitTextFillColor = 'transparent';

            // Update inputs
            const inputs = document.querySelectorAll('#preview-container input');
            inputs.forEach(input => {
                input.style.fontSize = settings.inputSize + 'px';
                input.style.borderColor = settings.inputBorder;
                input.style.padding = settings.inputPadding + 'px ' + settings.inputPadding + 'px ' + settings.inputPadding + 'px 45px';
            });

            // Update button
            previewBtn.textContent = settings.btnText;
            previewBtn.style.fontSize = settings.btnSize + 'px';
            previewBtn.style.background = `linear-gradient(135deg, ${settings.btnColor1}, ${settings.btnColor2})`;

            // Update container
            previewContainer.style.maxWidth = settings.maxWidth + 'px';
            previewContainer.style.marginTop = settings.marginTop + 'px';
        }

        function resetLoginLayout() {
            if (!confirm('M√∂chtest du wirklich alle Einstellungen auf Standard zur√ºcksetzen?')) {
                return;
            }

            // Reset to defaults
            document.getElementById('login-title-text').value = 'LOGIN';
            document.getElementById('login-title-size').value = 48;
            document.getElementById('login-title-color1').value = '#ffffff';
            document.getElementById('login-title-color2').value = '#ffd700';
            document.getElementById('login-input-size').value = 16;
            document.getElementById('login-input-border').value = '#d4af37';
            document.getElementById('login-input-padding').value = 15;
            document.getElementById('login-btn-text').value = 'LOGIN';
            document.getElementById('login-btn-size').value = 18;
            document.getElementById('login-btn-color1').value = '#4a3520';
            document.getElementById('login-btn-color2').value = '#6b4f30';
            document.getElementById('login-max-width').value = 400;
            document.getElementById('login-margin-top').value = 0;
            document.getElementById('anim-portal').checked = true;
            document.getElementById('anim-dragon').checked = true;
            document.getElementById('anim-sword').checked = true;
            document.getElementById('anim-lightning').checked = true;
            document.getElementById('anim-frame').checked = true;

            // Apply defaults
            applyLoginLayout();

            // Remove from localStorage
            localStorage.removeItem('loginLayoutSettings');

            alert('‚úÖ Login-Layout wurde auf Standard zur√ºckgesetzt!');
        }

        // Auto-update preview when values change
        document.addEventListener('DOMContentLoaded', function() {
            // Load saved settings
            const saved = localStorage.getItem('loginLayoutSettings');
            if (saved) {
                const settings = JSON.parse(saved);
                document.getElementById('login-title-text').value = settings.titleText;
                document.getElementById('login-title-size').value = settings.titleSize;
                document.getElementById('login-title-color1').value = settings.titleColor1;
                document.getElementById('login-title-color2').value = settings.titleColor2;
                document.getElementById('login-input-size').value = settings.inputSize;
                document.getElementById('login-input-border').value = settings.inputBorder;
                document.getElementById('login-input-padding').value = settings.inputPadding;
                document.getElementById('login-btn-text').value = settings.btnText;
                document.getElementById('login-btn-size').value = settings.btnSize;
                document.getElementById('login-btn-color1').value = settings.btnColor1;
                document.getElementById('login-btn-color2').value = settings.btnColor2;
                document.getElementById('login-max-width').value = settings.maxWidth;
                document.getElementById('login-margin-top').value = settings.marginTop;
                document.getElementById('anim-portal').checked = settings.animPortal;
                document.getElementById('anim-dragon').checked = settings.animDragon;
                document.getElementById('anim-sword').checked = settings.animSword;
                document.getElementById('anim-lightning').checked = settings.animLightning;
                document.getElementById('anim-frame').checked = settings.animFrame;
                updatePreview(settings);
            }

            // Add live update listeners
            const updateInputs = [
                'login-title-text', 'login-title-size', 'login-title-color1', 'login-title-color2',
                'login-input-size', 'login-input-border', 'login-input-padding',
                'login-btn-text', 'login-btn-size', 'login-btn-color1', 'login-btn-color2',
                'login-max-width', 'login-margin-top'
            ];

            updateInputs.forEach(id => {
                const element = document.getElementById(id);
                if (element) {
                    element.addEventListener('input', function() {
                        const settings = {
                            titleText: document.getElementById('login-title-text').value,
                            titleSize: document.getElementById('login-title-size').value,
                            titleColor1: document.getElementById('login-title-color1').value,
                            titleColor2: document.getElementById('login-title-color2').value,
                            inputSize: document.getElementById('login-input-size').value,
                            inputBorder: document.getElementById('login-input-border').value,
                            inputPadding: document.getElementById('login-input-padding').value,
                            btnText: document.getElementById('login-btn-text').value,
                            btnSize: document.getElementById('login-btn-size').value,
                            btnColor1: document.getElementById('login-btn-color1').value,
                            btnColor2: document.getElementById('login-btn-color2').value,
                            maxWidth: document.getElementById('login-max-width').value,
                            marginTop: document.getElementById('login-margin-top').value
                        };
                        updatePreview(settings);
                    });
                }
            });
        });

        // Combat System Tab Navigation
        function showCombatSection(section) {
            // Hide all sections
            document.querySelectorAll('.combat-section').forEach(s => s.style.display = 'none');
            // Remove active from all tabs
            document.querySelectorAll('[id^="combat-tab-"]').forEach(t => t.classList.remove('active'));
            
            // Show selected section
            document.getElementById('combat-section-' + section).style.display = 'block';
            document.getElementById('combat-tab-' + section).classList.add('active');
            
            // Initialize section if needed
            if (section === 'ranks' && !window.rankStatsInitialized) {
                initRankStats();
                window.rankStatsInitialized = true;
            } else if (section === 'skills-overview' && !window.skillsOverviewInitialized) {
                initSkillsOverview();
                window.skillsOverviewInitialized = true;
            } else if (section === 'skills-manage' && !window.skillsManageInitialized) {
                // Load skills for management
                if (window.adminUI && window.adminUI.loadSkills) {
                    window.adminUI.loadSkills();
                }
                window.skillsManageInitialized = true;
            }
        }

        // Initialize Rank Stats
        async function initRankStats() {
            const { RANK_STATS } = await import('./dist/combat/rank-stats.js');
            const ranks = ['E', 'D', 'C', 'B', 'A', 'S', 'SS', 'SSS'];
            
            // Render Rank Cards
            const grid = document.getElementById('rank-stats-grid');
            grid.innerHTML = '';
            
            const rankColors = {
                'E': '#95a5a6', 'D': '#7f8c8d', 'C': '#3498db', 'B': '#9b59b6',
                'A': '#e74c3c', 'S': '#f39c12', 'SS': '#e67e22', 'SSS': '#d4af37'
            };
            
            ranks.forEach(rank => {
                const stats = RANK_STATS[rank];
                const card = document.createElement('div');
                card.style.cssText = `background: rgba(255,255,255,0.1); border-radius: 10px; padding: 20px; border: 2px solid ${rankColors[rank]}; backdrop-filter: blur(10px);`;
                card.innerHTML = `
                    <div style="font-size: 1.5rem; font-weight: bold; margin-bottom: 15px; text-align: center; padding: 10px; border-radius: 5px; background: rgba(0,0,0,0.3);">${rank}-Rang</div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; opacity: 0.8;">‚öîÔ∏è Angriffs-Multiplikator</label>
                        <div style="font-size: 1.2rem; font-weight: bold; color: #4CAF50;">${stats.damageMultiplier}x</div>
                    </div>
                    <div style="margin-bottom: 15px;">
                        <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; opacity: 0.8;">üõ°Ô∏è Block-Reduzierung (%)</label>
                        <div style="font-size: 1.2rem; font-weight: bold; color: #4CAF50;">${stats.blockReduction}%</div>
                    </div>
                    <div>
                        <label style="display: block; margin-bottom: 5px; font-size: 0.9rem; opacity: 0.8;">üí® Dodge-Chance (%)</label>
                        <div style="font-size: 1.2rem; font-weight: bold; color: #4CAF50;">${stats.dodgeChance}%</div>
                    </div>
                `;
                grid.appendChild(card);
            });

            // Render Comparison Table
            const tbody = document.getElementById('rank-comparison-body');
            tbody.innerHTML = '';
            ranks.forEach((rank, idx) => {
                const stats = RANK_STATS[rank];
                const progression = idx === 0 ? 'Starter' : idx === ranks.length - 1 ? 'Maximum' : 'Progression';
                const row = document.createElement('tr');
                if (idx % 2 === 1) row.style.background = 'rgba(255,255,255,0.05)';
                row.innerHTML = `
                    <td style="padding: 12px; text-align: center;"><strong>${rank}</strong></td>
                    <td style="padding: 12px; text-align: center;">${stats.damageMultiplier}x</td>
                    <td style="padding: 12px; text-align: center;">${stats.blockReduction}%</td>
                    <td style="padding: 12px; text-align: center;">${stats.dodgeChance}%</td>
                    <td style="padding: 12px; text-align: center;">${progression}</td>
                `;
                tbody.appendChild(row);
            });
        }

        // Initialize Skills Overview
        async function initSkillsOverview() {
            const container = document.getElementById('roles-container');
            container.innerHTML = '<div style="text-align: center; padding: 40px; opacity: 0.7;">‚è≥ Lade Skills aus Datenbank...</div>';
            
            try {
                // Load skills from database
                const response = await fetch('http://localhost:3001/api/skills');
                if (!response.ok) throw new Error('Failed to load skills');
                
                const data = await response.json();
                const allSkills = data.skills || [];
                
                console.log('üìñ Loaded', allSkills.length, 'skills for overview');
                
                if (allSkills.length === 0) {
                    container.innerHTML = '<div style="text-align: center; padding: 40px;">‚ö†Ô∏è Keine Skills in der Datenbank gefunden!</div>';
                    return;
                }
                
                // Group skills by role (extract from skill ID)
                const skillsByRole = {};
                allSkills.forEach(skill => {
                    // Extract role from skill ID (e.g., "waechter_shield_stance" -> "waechter")
                    const roleMatch = skill.id.match(/^([a-z]+)_/);
                    const role = roleMatch ? roleMatch[1] : 'hunter';
                    
                    if (!skillsByRole[role]) {
                        skillsByRole[role] = [];
                    }
                    skillsByRole[role].push(skill);
                });
                
                const ROLE_ICONS = {
                    waechter: 'üõ°Ô∏è', assassine: 'üó°Ô∏è', magier: 'üîÆ', heiler: '‚ú®',
                    beschwoerer: 'üßø', berserker: 'ü©∏', fluchwirker: '‚ò†Ô∏è', hunter: 'üéØ'
                };
                
                const ROLE_NAMES = {
                    waechter: 'W√§chter', assassine: 'Assassine', magier: 'Magier', heiler: 'Heiler',
                    beschwoerer: 'Beschw√∂rer', berserker: 'Berserker', fluchwirker: 'Fluchwirker', hunter: 'Hunter'
                };
                
                container.innerHTML = '';
                
                for (const [role, skills] of Object.entries(skillsByRole)) {
                    const roleCard = document.createElement('div');
                    roleCard.style.cssText = 'background: rgba(255,255,255,0.08); border-radius: 10px; padding: 20px; border: 2px solid rgba(255,255,255,0.2);';
                    
                    const roleHeader = document.createElement('div');
                    roleHeader.style.cssText = 'font-size: 1.3rem; margin-bottom: 15px; padding-bottom: 10px; border-bottom: 2px solid rgba(255,255,255,0.3);';
                    roleHeader.textContent = `${ROLE_ICONS[role] || 'üéØ'} ${ROLE_NAMES[role] || role}`;
                    roleCard.appendChild(roleHeader);
                    
                    skills.forEach(skill => {
                        const skillItem = document.createElement('div');
                        const skillTypeColors = {
                            damage: '#e74c3c',
                            heal: '#2ecc71',
                            buff: '#3498db',
                            debuff: '#9b59b6',
                            dot: '#e67e22'
                        };
                        const borderColor = skillTypeColors[skill.skill_type] || '#95a5a6';
                        skillItem.style.cssText = `background: rgba(255,255,255,0.05); padding: 12px; margin-bottom: 10px; border-radius: 5px; border-left: 3px solid ${borderColor};`;
                        
                        const costs = [];
                        if (skill.base_value > 0) {
                            const typeLabel = skill.skill_type === 'damage' ? 'Schaden' : 
                                            skill.skill_type === 'heal' ? 'Heilung' : 
                                            skill.skill_type === 'buff' ? 'Buff' : 
                                            skill.skill_type === 'debuff' ? 'Debuff' : 
                                            skill.skill_type === 'dot' ? 'DoT' : 'Wert';
                            costs.push(`üí• ${typeLabel}: ${skill.base_value}`);
                        }
                        if (skill.mana_cost > 0) costs.push(`üíß Mana: ${skill.mana_cost}`);
                        if (skill.stamina_cost > 0) costs.push(`‚ö° Ausdauer: ${skill.stamina_cost}`);
                        if (skill.cooldown > 0) costs.push(`‚è±Ô∏è CD: ${skill.cooldown}s`);
                        if (skill.duration > 0) costs.push(`‚è≥ Dauer: ${skill.duration}t`);
                        
                        skillItem.innerHTML = `
                            <div style="font-weight: bold; margin-bottom: 5px;">${skill.name}</div>
                            <div style="font-size: 0.85rem; opacity: 0.8; margin-bottom: 8px;">${skill.description}</div>
                            <div style="display: flex; gap: 10px; font-size: 0.8rem; flex-wrap: wrap;">
                                ${costs.map(c => `<span style="background: rgba(0,0,0,0.4); padding: 4px 8px; border-radius: 3px;">${c}</span>`).join('')}
                            </div>
                        `;
                        roleCard.appendChild(skillItem);
                    });
                    
                    container.appendChild(roleCard);
                }
                
            } catch (error) {
                console.error('Error loading skills overview:', error);
                container.innerHTML = '<div style="text-align: center; padding: 40px; color: #e74c3c;">‚ùå Fehler beim Laden der Skills!</div>';
            }
        }
    </script>
</html>

